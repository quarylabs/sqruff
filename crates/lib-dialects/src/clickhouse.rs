use itertools::Itertools;
use sqruff_lib_core::dialects::Dialect;
use sqruff_lib_core::dialects::init::DialectKind;
use sqruff_lib_core::dialects::syntax::SyntaxKind;
use sqruff_lib_core::helpers::{Config, ToMatchable};
use sqruff_lib_core::parser::grammar::anyof::{AnyNumberOf, one_of, optionally_bracketed};
use sqruff_lib_core::parser::grammar::conditional::Conditional;
use sqruff_lib_core::parser::grammar::delimited::Delimited;
use sqruff_lib_core::parser::grammar::sequence::{Bracketed, Sequence};
use sqruff_lib_core::parser::grammar::{Nothing, Ref};
use sqruff_lib_core::parser::lexer::Matcher;
use sqruff_lib_core::parser::matchable::MatchableTrait;
use sqruff_lib_core::parser::node_matcher::NodeMatcher;
use sqruff_lib_core::parser::parsers::{RegexParser, StringParser, TypedParser};
use sqruff_lib_core::parser::segments::generator::SegmentGenerator;
use sqruff_lib_core::parser::segments::meta::MetaSegment;
use sqruff_lib_core::parser::types::ParseMode;

use super::clickhouse_keywords::UNRESERVED_KEYWORDS;

pub fn dialect() -> Dialect {
    raw_dialect().config(|this| this.expand())
}

pub fn raw_dialect() -> Dialect {
    let ansi_dialect = super::ansi::raw_dialect();
    let mut clickhouse_dialect = ansi_dialect.clone();
    clickhouse_dialect.name = DialectKind::Clickhouse;

    clickhouse_dialect
        .sets_mut("unreserved_keywords")
        .extend(UNRESERVED_KEYWORDS);

    clickhouse_dialect.insert_lexer_matchers(
        vec![Matcher::string("lambda", r#"->"#, SyntaxKind::Lambda)],
        "newline",
    );

    clickhouse_dialect.patch_lexer_matchers(vec![
        Matcher::regex(
            "double_quote",
            r#""([^"\\]|""|\\.)*""#,
            SyntaxKind::DoubleQuote,
        ),
        Matcher::regex(
            "back_quote",
            r#"`(?:[^`\\]|``|\\.)*`"#,
            SyntaxKind::BackQuote,
        ),
    ]);

    clickhouse_dialect.add([
        (
            "BackQuotedIdentifierSegment".into(),
            TypedParser::new(SyntaxKind::BackQuote, SyntaxKind::QuotedIdentifier)
                .to_matchable()
                .into(),
        ),
        (
            "LambdaFunctionSegment".into(),
            TypedParser::new(SyntaxKind::Lambda, SyntaxKind::Lambda)
                .to_matchable()
                .into(),
        ),
    ]);

    clickhouse_dialect.add([(
        "NakedIdentifierSegment".into(),
        SegmentGenerator::new(|dialect| {
            let reserved_keywords = dialect.sets("reserved_keywords");
            let pattern = reserved_keywords.iter().join("|");
            let anti_template = format!("^({pattern})$");
            RegexParser::new(r#"[a-zA-Z_][0-9a-zA-Z_]*"#, SyntaxKind::NakedIdentifier)
                .anti_template(&anti_template)
                .to_matchable()
        })
        .into(),
    )]);

    clickhouse_dialect.replace_grammar(
        "BinaryOperatorGrammar",
        one_of(vec![
            Ref::new("ArithmeticBinaryOperatorGrammar").to_matchable(),
            Ref::new("StringBinaryOperatorGrammar").to_matchable(),
            Ref::new("BooleanBinaryOperatorGrammar").to_matchable(),
            Ref::new("ComparisonOperatorGrammar").to_matchable(),
            Ref::new("LambdaFunctionSegment").to_matchable(),
        ])
        .to_matchable(),
    );

    clickhouse_dialect.replace_grammar(
        "JoinTypeKeywordsGrammar",
        Sequence::new(vec![
            Ref::keyword("GLOBAL").optional().to_matchable(),
            one_of(vec![
                Sequence::new(vec![
                    Ref::keyword("INNER").to_matchable(),
                    one_of(vec![
                        Ref::keyword("ALL").to_matchable(),
                        Ref::keyword("ANY").to_matchable(),
                    ])
                    .config(|this| {
                        this.optional();
                    })
                    .to_matchable(),
                ])
                .to_matchable(),
                Sequence::new(vec![
                    one_of(vec![
                        Ref::keyword("ALL").to_matchable(),
                        Ref::keyword("ANY").to_matchable(),
                    ])
                    .config(|this| {
                        this.optional();
                    })
                    .to_matchable(),
                    Ref::keyword("INNER").to_matchable(),
                ])
                .to_matchable(),
                Sequence::new(vec![
                    Ref::keyword("FULL").to_matchable(),
                    Ref::keyword("ALL").optional().to_matchable(),
                    Ref::keyword("OUTER").optional().to_matchable(),
                ])
                .to_matchable(),
                Sequence::new(vec![
                    Ref::keyword("ALL").optional().to_matchable(),
                    Ref::keyword("FULL").to_matchable(),
                    Ref::keyword("OUTER").optional().to_matchable(),
                ])
                .to_matchable(),
                Sequence::new(vec![
                    Ref::keyword("LEFT").to_matchable(),
                    one_of(vec![
                        Ref::keyword("ANTI").to_matchable(),
                        Ref::keyword("SEMI").to_matchable(),
                        one_of(vec![
                            Ref::keyword("ANY").to_matchable(),
                            Ref::keyword("ALL").to_matchable(),
                        ])
                        .config(|this| {
                            this.optional();
                        })
                        .to_matchable(),
                        Ref::keyword("ASOF").to_matchable(),
                    ])
                    .config(|this| {
                        this.optional();
                    })
                    .to_matchable(),
                    Ref::keyword("OUTER").optional().to_matchable(),
                ])
                .to_matchable(),
                Sequence::new(vec![
                    one_of(vec![
                        Ref::keyword("ANTI").to_matchable(),
                        Ref::keyword("SEMI").to_matchable(),
                        one_of(vec![
                            Ref::keyword("ANY").to_matchable(),
                            Ref::keyword("ALL").to_matchable(),
                        ])
                        .config(|this| {
                            this.optional();
                        })
                        .to_matchable(),
                        Ref::keyword("ASOF").to_matchable(),
                    ])
                    .to_matchable(),
                    Ref::keyword("LEFT").to_matchable(),
                ])
                .to_matchable(),
                Sequence::new(vec![
                    Ref::keyword("RIGHT").to_matchable(),
                    one_of(vec![
                        Ref::keyword("OUTER").to_matchable(),
                        Ref::keyword("ANTI").to_matchable(),
                        Ref::keyword("SEMI").to_matchable(),
                        one_of(vec![
                            Ref::keyword("ANY").to_matchable(),
                            Ref::keyword("ALL").to_matchable(),
                        ])
                        .config(|this| {
                            this.optional();
                        })
                        .to_matchable(),
                    ])
                    .config(|this| {
                        this.optional();
                    })
                    .to_matchable(),
                    Ref::keyword("OUTER").optional().to_matchable(),
                ])
                .to_matchable(),
                Sequence::new(vec![
                    one_of(vec![
                        Ref::keyword("ANTI").to_matchable(),
                        Ref::keyword("SEMI").to_matchable(),
                        one_of(vec![
                            Ref::keyword("ANY").to_matchable(),
                            Ref::keyword("ALL").to_matchable(),
                        ])
                        .config(|this| {
                            this.optional();
                        })
                        .to_matchable(),
                    ])
                    .config(|this| {
                        this.optional();
                    })
                    .to_matchable(),
                    Ref::keyword("RIGHT").to_matchable(),
                ])
                .to_matchable(),
                Ref::keyword("ASOF").to_matchable(),
                Ref::keyword("ANY").to_matchable(),
                Ref::keyword("ALL").to_matchable(),
            ])
            .to_matchable(),
        ])
        .to_matchable(),
    );

    clickhouse_dialect.replace_grammar(
        "JoinUsingConditionGrammar",
        Sequence::new(vec![
            Ref::keyword("USING").to_matchable(),
            Conditional::new(MetaSegment::indent()).to_matchable(),
            Delimited::new(vec![
                one_of(vec![
                    Bracketed::new(vec![
                        Delimited::new(vec![Ref::new("SingleIdentifierGrammar").to_matchable()])
                            .to_matchable(),
                    ])
                    .config(|this| {
                        this.parse_mode(ParseMode::Greedy);
                    })
                    .to_matchable(),
                    Delimited::new(vec![Ref::new("SingleIdentifierGrammar").to_matchable()])
                        .to_matchable(),
                ])
                .to_matchable(),
            ])
            .to_matchable(),
            Conditional::new(MetaSegment::dedent()).to_matchable(),
        ])
        .to_matchable(),
    );

    clickhouse_dialect.replace_grammar(
        "ConditionalCrossJoinKeywordsGrammar",
        Nothing::new().to_matchable(),
    );

    clickhouse_dialect.replace_grammar(
        "UnconditionalCrossJoinKeywordsGrammar",
        Sequence::new(vec![
            Ref::keyword("GLOBAL").optional().to_matchable(),
            Ref::keyword("CROSS").to_matchable(),
        ])
        .to_matchable(),
    );

    clickhouse_dialect.replace_grammar(
        "HorizontalJoinKeywordsGrammar",
        Sequence::new(vec![
            Ref::keyword("GLOBAL").optional().to_matchable(),
            Ref::keyword("PASTE").to_matchable(),
        ])
        .to_matchable(),
    );

    clickhouse_dialect.replace_grammar("NaturalJoinKeywordsGrammar", Nothing::new().to_matchable());

    clickhouse_dialect.replace_grammar(
        "JoinLikeClauseGrammar",
        Sequence::new(vec![
            AnyNumberOf::new(vec![Ref::new("ArrayJoinClauseSegment").to_matchable()])
                .config(|this| {
                    this.min_times(1);
                })
                .to_matchable(),
            Ref::new("AliasExpressionSegment").optional().to_matchable(),
        ])
        .to_matchable(),
    );

    clickhouse_dialect.replace_grammar(
        "QuotedLiteralSegment",
        one_of(vec![
            TypedParser::new(SyntaxKind::SingleQuote, SyntaxKind::QuotedLiteral).to_matchable(),
            TypedParser::new(SyntaxKind::DollarQuote, SyntaxKind::QuotedLiteral).to_matchable(),
        ])
        .to_matchable(),
    );

    clickhouse_dialect.replace_grammar(
        "SingleIdentifierGrammar",
        one_of(vec![
            Ref::new("NakedIdentifierSegment").to_matchable(),
            Ref::new("QuotedIdentifierSegment").to_matchable(),
            Ref::new("SingleQuotedIdentifierSegment").to_matchable(),
            Ref::new("BackQuotedIdentifierSegment").to_matchable(),
        ])
        .to_matchable(),
    );

    clickhouse_dialect.replace_grammar(
        "InOperatorGrammar",
        Sequence::new(vec![
            Ref::keyword("GLOBAL").optional().to_matchable(),
            Ref::keyword("NOT").optional().to_matchable(),
            Ref::keyword("IN").to_matchable(),
            one_of(vec![
                Ref::new("FunctionSegment").to_matchable(),
                Ref::new("ArrayLiteralSegment").to_matchable(),
                Ref::new("TupleSegment").to_matchable(),
                Ref::new("SingleIdentifierGrammar").to_matchable(),
                Bracketed::new(vec![
                    one_of(vec![
                        Delimited::new(vec![Ref::new("Expression_A_Grammar").to_matchable()])
                            .to_matchable(),
                        Ref::new("SelectableGrammar").to_matchable(),
                    ])
                    .to_matchable(),
                ])
                .config(|this| {
                    this.parse_mode(ParseMode::Greedy);
                })
                .to_matchable(),
            ])
            .to_matchable(),
        ])
        .to_matchable(),
    );

    clickhouse_dialect.replace_grammar(
        "SelectClauseTerminatorGrammar",
        ansi_dialect.grammar("SelectClauseTerminatorGrammar").copy(
            Some(vec![
                Ref::keyword("PREWHERE").to_matchable(),
                Ref::keyword("INTO").to_matchable(),
                Ref::keyword("FORMAT").to_matchable(),
            ]),
            None,
            Some(Ref::keyword("WHERE").to_matchable()),
            None,
            vec![],
            false,
        ),
    );

    clickhouse_dialect.replace_grammar(
        "FromClauseTerminatorGrammar",
        ansi_dialect
            .grammar("FromClauseTerminatorGrammar")
            .copy(
                Some(vec![
                    Ref::keyword("PREWHERE").to_matchable(),
                    Ref::keyword("INTO").to_matchable(),
                    Ref::keyword("FORMAT").to_matchable(),
                ]),
                None,
                Some(Ref::keyword("WHERE").to_matchable()),
                None,
                vec![],
                false,
            )
            .copy(
                Some(vec![Ref::new("SettingsClauseSegment").to_matchable()]),
                None,
                None,
                None,
                vec![],
                false,
            ),
    );

    clickhouse_dialect.replace_grammar(
        "DateTimeLiteralGrammar",
        Sequence::new(vec![
            one_of(vec![
                Ref::keyword("DATE").to_matchable(),
                Ref::keyword("TIME").to_matchable(),
                Ref::keyword("TIMESTAMP").to_matchable(),
            ])
            .to_matchable(),
            TypedParser::new(SyntaxKind::SingleQuote, SyntaxKind::DateConstructorLiteral)
                .to_matchable(),
        ])
        .to_matchable(),
    );

    clickhouse_dialect.replace_grammar(
        "AlterTableDropColumnGrammar",
        Sequence::new(vec![
            Ref::new("OnClusterClauseSegment").optional().to_matchable(),
            Ref::keyword("DROP").to_matchable(),
            Ref::keyword("COLUMN").to_matchable(),
            Ref::new("IfExistsGrammar").optional().to_matchable(),
            Ref::new("SingleIdentifierGrammar").to_matchable(),
        ])
        .to_matchable(),
    );

    clickhouse_dialect.sets_mut("datetime_units").clear();

    clickhouse_dialect.sets_mut("datetime_units").extend([
        "NANOSECOND",
        "NANOSECONDS",
        "SQL_TSI_NANOSECOND",
        "NS",
        "MICROSECOND",
        "MICROSECONDS",
        "SQL_TSI_MICROSECOND",
        "MCS",
        "MILLISECOND",
        "MILLISECONDS",
        "SQL_TSI_MILLISECOND",
        "MS",
        "SECOND",
        "SECONDS",
        "SQL_TSI_SECOND",
        "SS",
        "S",
        "MINUTE",
        "MINUTES",
        "SQL_TSI_MINUTE",
        "MI",
        "N",
        "HOUR",
        "HOURS",
        "SQL_TSI_HOUR",
        "HH",
        "H",
        "DAY",
        "DAYS",
        "SQL_TSI_DAY",
        "DD",
        "D",
        "WEEK",
        "WEEKS",
        "SQL_TSI_WEEK",
        "WK",
        "WW",
        "MONTH",
        "MONTHS",
        "SQL_TSI_MONTH",
        "MM",
        "M",
        "QUARTER",
        "QUARTERS",
        "SQL_TSI_QUARTER",
        "QQ",
        "Q",
        "YEAR",
        "YEARS",
        "SQL_TSI_YEAR",
        "YYYY",
        "YY",
    ]);

    clickhouse_dialect.add([
        (
            "IntoOutfileClauseSegment".into(),
            NodeMatcher::new(SyntaxKind::IntoOutfileClause, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("INTO").to_matchable(),
                    Ref::keyword("OUTFILE").to_matchable(),
                    Ref::new("QuotedLiteralSegment").to_matchable(),
                    Ref::new("FormatClauseSegment").optional().to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "FormatClauseSegment".into(),
            NodeMatcher::new(SyntaxKind::FormatClause, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("FORMAT").to_matchable(),
                    one_of(
                        super::clickhouse_keywords::FORMAT_KEYWORDS
                            .iter()
                            .map(|item| Ref::keyword(*item).to_matchable())
                            .collect_vec(),
                    )
                    .to_matchable(),
                    Ref::new("SettingsClauseSegment").optional().to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "MergeTreesOrderByClauseSegment".into(),
            NodeMatcher::new(SyntaxKind::MergeTreeOrderByClause, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("ORDER").to_matchable(),
                    Ref::keyword("BY").to_matchable(),
                    one_of(vec![
                        Sequence::new(vec![
                            Ref::keyword("TUPLE").to_matchable(),
                            Bracketed::new(vec![]).to_matchable(),
                        ])
                        .to_matchable(),
                        Bracketed::new(vec![
                            Delimited::new(vec![
                                Ref::new("ColumnReferenceSegment").to_matchable(),
                                Ref::new("ExpressionSegment").to_matchable(),
                            ])
                            .to_matchable(),
                        ])
                        .to_matchable(),
                        Ref::new("ColumnReferenceSegment").to_matchable(),
                    ])
                    .to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "PreWhereClauseSegment".into(),
            NodeMatcher::new(SyntaxKind::PrewhereClause, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("PREWHERE").to_matchable(),
                    MetaSegment::implicit_indent().to_matchable(),
                    optionally_bracketed(vec![Ref::new("ExpressionSegment").to_matchable()])
                        .to_matchable(),
                    MetaSegment::dedent().to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "SettingsClauseSegment".into(),
            NodeMatcher::new(SyntaxKind::SettingsClause, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("SETTINGS").to_matchable(),
                    Delimited::new(vec![
                        Sequence::new(vec![
                            Ref::new("NakedIdentifierSegment").to_matchable(),
                            Ref::new("EqualsSegment").to_matchable(),
                            one_of(vec![
                                Ref::new("NakedIdentifierSegment").to_matchable(),
                                Ref::new("NumericLiteralSegment").to_matchable(),
                                Ref::new("QuotedLiteralSegment").to_matchable(),
                                Ref::new("BooleanLiteralGrammar").to_matchable(),
                            ])
                            .to_matchable(),
                        ])
                        .config(|this| {
                            this.optional();
                        })
                        .to_matchable(),
                    ])
                    .to_matchable(),
                ])
                .config(|this| {
                    this.optional();
                })
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "SelectStatementSegment".into(),
            NodeMatcher::new(SyntaxKind::SelectStatement, |_dialect| {
                {
                    let dialect = super::ansi::raw_dialect();
                    dialect
                        .grammar("SelectStatementSegment")
                        .match_grammar(&dialect)
                        .unwrap()
                }
                .copy(
                    Some(vec![
                        Ref::new("PreWhereClauseSegment").optional().to_matchable(),
                    ]),
                    None,
                    Some(Ref::new("WhereClauseSegment").optional().to_matchable()),
                    None,
                    vec![],
                    false,
                )
                .copy(
                    Some(vec![
                        Ref::new("FormatClauseSegment").optional().to_matchable(),
                        Ref::new("IntoOutfileClauseSegment")
                            .optional()
                            .to_matchable(),
                        Ref::new("SettingsClauseSegment").optional().to_matchable(),
                    ]),
                    None,
                    None,
                    None,
                    vec![],
                    false,
                )
            })
            .to_matchable()
            .into(),
        ),
        (
            "UnorderedSelectStatementSegment".into(),
            NodeMatcher::new(SyntaxKind::SelectStatement, |_dialect| {
                {
                    let dialect = super::ansi::raw_dialect();
                    dialect
                        .grammar("UnorderedSelectStatementSegment")
                        .match_grammar(&dialect)
                        .unwrap()
                }
                .copy(
                    Some(vec![
                        Ref::new("PreWhereClauseSegment").optional().to_matchable(),
                    ]),
                    None,
                    Some(Ref::new("WhereClauseSegment").optional().to_matchable()),
                    None,
                    vec![],
                    false,
                )
            })
            .to_matchable()
            .into(),
        ),
        (
            "WithFillSegment".into(),
            NodeMatcher::new(SyntaxKind::WithFill, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("WITH").to_matchable(),
                    Ref::keyword("FILL").to_matchable(),
                    Sequence::new(vec![
                        Ref::keyword("FROM").to_matchable(),
                        Ref::new("ExpressionSegment").to_matchable(),
                    ])
                    .config(|this| {
                        this.optional();
                    })
                    .to_matchable(),
                    Sequence::new(vec![
                        Ref::keyword("TO").to_matchable(),
                        Ref::new("ExpressionSegment").to_matchable(),
                    ])
                    .config(|this| {
                        this.optional();
                    })
                    .to_matchable(),
                    Sequence::new(vec![
                        Ref::keyword("STEP").to_matchable(),
                        one_of(vec![
                            Ref::new("NumericLiteralSegment").to_matchable(),
                            Ref::new("IntervalExpressionSegment").to_matchable(),
                        ])
                        .to_matchable(),
                    ])
                    .config(|this| {
                        this.optional();
                    })
                    .to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "BracketedArguments".into(),
            NodeMatcher::new(SyntaxKind::BracketedArguments, |_dialect| {
                Bracketed::new(vec![
                    Delimited::new(vec![
                        one_of(vec![Ref::new("DatatypeSegment").to_matchable()]).to_matchable(),
                    ])
                    .config(|this| {
                        this.optional();
                    })
                    .to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "DatatypeSegment".into(),
            NodeMatcher::new(SyntaxKind::DataType, |_dialect| {
                one_of(vec![
                    Sequence::new(vec![
                        StringParser::new("NULLABLE", SyntaxKind::DataTypeIdentifier)
                            .to_matchable(),
                        Bracketed::new(vec![Ref::new("DatatypeSegment").to_matchable()])
                            .to_matchable(),
                    ])
                    .to_matchable(),
                    Sequence::new(vec![
                        StringParser::new("LOWCARDINALITY", SyntaxKind::DataTypeIdentifier)
                            .to_matchable(),
                        Bracketed::new(vec![Ref::new("DatatypeSegment").to_matchable()])
                            .to_matchable(),
                    ])
                    .to_matchable(),
                    Sequence::new(vec![
                        StringParser::new("DATETIME64", SyntaxKind::DataTypeIdentifier)
                            .to_matchable(),
                        Bracketed::new(vec![
                            Delimited::new(vec![
                                one_of(vec![
                                    Ref::new("NumericLiteralSegment").to_matchable(),
                                    Ref::new("QuotedLiteralSegment").to_matchable(),
                                ])
                                .to_matchable(),
                            ])
                            .config(|this| {
                                this.optional();
                                this.delimiter(Ref::new("CommaSegment"));
                            })
                            .to_matchable(),
                        ])
                        .to_matchable(),
                    ])
                    .to_matchable(),
                    Sequence::new(vec![
                        StringParser::new("DATETIME", SyntaxKind::DataTypeIdentifier)
                            .to_matchable(),
                        Bracketed::new(vec![Ref::new("QuotedLiteralSegment").to_matchable()])
                            .config(|this| {
                                this.optional();
                            })
                            .to_matchable(),
                    ])
                    .to_matchable(),
                    Sequence::new(vec![
                        StringParser::new("FIXEDSTRING", SyntaxKind::DataTypeIdentifier)
                            .to_matchable(),
                        Bracketed::new(vec![Ref::new("NumericLiteralSegment").to_matchable()])
                            .to_matchable(),
                    ])
                    .to_matchable(),
                    Sequence::new(vec![
                        StringParser::new("ARRAY", SyntaxKind::DataTypeIdentifier).to_matchable(),
                        Bracketed::new(vec![Ref::new("DatatypeSegment").to_matchable()])
                            .to_matchable(),
                    ])
                    .to_matchable(),
                    Sequence::new(vec![
                        StringParser::new("MAP", SyntaxKind::DataTypeIdentifier).to_matchable(),
                        Bracketed::new(vec![
                            Delimited::new(vec![Ref::new("DatatypeSegment").to_matchable()])
                                .config(|this| {
                                    this.delimiter(Ref::new("CommaSegment"));
                                })
                                .to_matchable(),
                        ])
                        .to_matchable(),
                    ])
                    .to_matchable(),
                    Sequence::new(vec![
                        StringParser::new("TUPLE", SyntaxKind::DataTypeIdentifier).to_matchable(),
                        Bracketed::new(vec![
                            Delimited::new(vec![
                                one_of(vec![
                                    Sequence::new(vec![
                                        one_of(vec![
                                            Ref::new("SingleIdentifierGrammar").to_matchable(),
                                            Ref::new("QuotedIdentifierSegment").to_matchable(),
                                        ])
                                        .to_matchable(),
                                        Ref::new("DatatypeSegment").to_matchable(),
                                    ])
                                    .to_matchable(),
                                    Ref::new("DatatypeSegment").to_matchable(),
                                ])
                                .to_matchable(),
                            ])
                            .config(|this| {
                                this.delimiter(Ref::new("CommaSegment"));
                            })
                            .to_matchable(),
                        ])
                        .to_matchable(),
                    ])
                    .to_matchable(),
                    Sequence::new(vec![
                        StringParser::new("NESTED", SyntaxKind::DataTypeIdentifier).to_matchable(),
                        Bracketed::new(vec![
                            Delimited::new(vec![
                                Sequence::new(vec![
                                    Ref::new("SingleIdentifierGrammar").to_matchable(),
                                    Ref::new("DatatypeSegment").to_matchable(),
                                ])
                                .to_matchable(),
                            ])
                            .config(|this| {
                                this.delimiter(Ref::new("CommaSegment"));
                            })
                            .to_matchable(),
                        ])
                        .to_matchable(),
                    ])
                    .to_matchable(),
                    StringParser::new("JSON", SyntaxKind::DataTypeIdentifier).to_matchable(),
                    Sequence::new(vec![
                        one_of(vec![
                            StringParser::new("ENUM8", SyntaxKind::DataTypeIdentifier)
                                .to_matchable(),
                            StringParser::new("ENUM16", SyntaxKind::DataTypeIdentifier)
                                .to_matchable(),
                        ])
                        .to_matchable(),
                        Bracketed::new(vec![
                            Delimited::new(vec![
                                Sequence::new(vec![
                                    Ref::new("QuotedLiteralSegment").to_matchable(),
                                    Ref::new("EqualsSegment").to_matchable(),
                                    Ref::new("NumericLiteralSegment").to_matchable(),
                                ])
                                .to_matchable(),
                            ])
                            .config(|this| {
                                this.delimiter(Ref::new("CommaSegment"));
                            })
                            .to_matchable(),
                        ])
                        .to_matchable(),
                    ])
                    .to_matchable(),
                    Sequence::new(vec![
                        one_of(vec![
                            StringParser::new("DECIMAL", SyntaxKind::DataTypeIdentifier)
                                .to_matchable(),
                            StringParser::new("NUMERIC", SyntaxKind::DataTypeIdentifier)
                                .to_matchable(),
                        ])
                        .to_matchable(),
                        Ref::new("BracketedArguments").optional().to_matchable(),
                    ])
                    .to_matchable(),
                    Sequence::new(vec![
                        one_of(vec![
                            StringParser::new("DECIMAL32", SyntaxKind::DataTypeIdentifier)
                                .to_matchable(),
                            StringParser::new("DECIMAL64", SyntaxKind::DataTypeIdentifier)
                                .to_matchable(),
                            StringParser::new("DECIMAL128", SyntaxKind::DataTypeIdentifier)
                                .to_matchable(),
                            StringParser::new("DECIMAL256", SyntaxKind::DataTypeIdentifier)
                                .to_matchable(),
                        ])
                        .to_matchable(),
                        Bracketed::new(vec![Ref::new("NumericLiteralSegment").to_matchable()])
                            .to_matchable(),
                    ])
                    .to_matchable(),
                    Ref::new("TupleTypeSegment").to_matchable(),
                    Ref::new("DatatypeIdentifierSegment").to_matchable(),
                    Ref::new("NumericLiteralSegment").to_matchable(),
                    Sequence::new(vec![
                        StringParser::new("DATETIME64", SyntaxKind::DataTypeIdentifier)
                            .to_matchable(),
                        Bracketed::new(vec![
                            Delimited::new(vec![
                                Ref::new("NumericLiteralSegment").to_matchable(),
                                Ref::new("QuotedLiteralSegment").optional().to_matchable(),
                            ])
                            .config(|this| {
                                this.optional();
                            })
                            .to_matchable(),
                        ])
                        .config(|this| {
                            this.optional();
                        })
                        .to_matchable(),
                    ])
                    .to_matchable(),
                    Sequence::new(vec![
                        StringParser::new("ARRAY", SyntaxKind::DataTypeIdentifier).to_matchable(),
                        Bracketed::new(vec![Ref::new("DatatypeSegment").to_matchable()])
                            .to_matchable(),
                    ])
                    .to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "TupleTypeSegment".into(),
            NodeMatcher::new(SyntaxKind::StructType, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("TUPLE").to_matchable(),
                    Ref::new("TupleTypeSchemaSegment").to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "TupleTypeSchemaSegment".into(),
            NodeMatcher::new(SyntaxKind::TupleTypeSchema, |_dialect| {
                Bracketed::new(vec![
                    Delimited::new(vec![
                        Sequence::new(vec![
                            Ref::new("SingleIdentifierGrammar").to_matchable(),
                            Ref::new("DatatypeSegment").to_matchable(),
                        ])
                        .to_matchable(),
                    ])
                    .to_matchable(),
                ])
                .config(|this| {
                    this.bracket_type("round");
                    this.bracket_pairs_set = "bracket_pairs";
                })
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "ArrayJoinClauseSegment".into(),
            NodeMatcher::new(SyntaxKind::ArrayJoinClause, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("LEFT").optional().to_matchable(),
                    Ref::keyword("ARRAY").to_matchable(),
                    Ref::new("JoinKeywordsGrammar").to_matchable(),
                    MetaSegment::indent().to_matchable(),
                    Delimited::new(vec![Ref::new("SelectClauseElementSegment").to_matchable()])
                        .to_matchable(),
                    MetaSegment::dedent().to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "CTEDefinitionSegment".into(),
            NodeMatcher::new(SyntaxKind::CommonTableExpression, |_dialect| {
                one_of(vec![
                    Sequence::new(vec![
                        Ref::new("SingleIdentifierGrammar").to_matchable(),
                        Ref::new("CTEColumnList").optional().to_matchable(),
                        Ref::keyword("AS").to_matchable(),
                        Bracketed::new(vec![Ref::new("SelectableGrammar").to_matchable()])
                            .config(|this| {
                                this.parse_mode(ParseMode::Greedy);
                            })
                            .to_matchable(),
                    ])
                    .to_matchable(),
                    Sequence::new(vec![
                        Ref::new("ExpressionSegment").to_matchable(),
                        Ref::keyword("AS").to_matchable(),
                        Ref::new("SingleIdentifierGrammar").to_matchable(),
                    ])
                    .to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "AliasExpressionSegment".into(),
            NodeMatcher::new(SyntaxKind::AliasExpression, |_dialect| {
                Sequence::new(vec![
                    MetaSegment::indent().to_matchable(),
                    Ref::new("AsAliasOperatorSegment").optional().to_matchable(),
                    one_of(vec![
                        Sequence::new(vec![
                            Ref::new("SingleIdentifierGrammar").to_matchable(),
                            Bracketed::new(vec![
                                Ref::new("SingleIdentifierListSegment").to_matchable(),
                            ])
                            .config(|this| {
                                this.optional();
                            })
                            .to_matchable(),
                        ])
                        .to_matchable(),
                        Ref::new("SingleQuotedIdentifierSegment").to_matchable(),
                    ])
                    .config(|this| {
                        this.exclude = Some(
                            one_of(vec![
                                Ref::keyword("LATERAL").to_matchable(),
                                Ref::keyword("WINDOW").to_matchable(),
                                Ref::keyword("KEYS").to_matchable(),
                            ])
                            .to_matchable(),
                        );
                    })
                    .to_matchable(),
                    MetaSegment::dedent().to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "WildcardExpressionSegment".into(),
            NodeMatcher::new(SyntaxKind::WildcardExpression, |_dialect| {
                {
                    let dialect = super::ansi::raw_dialect();
                    dialect
                        .grammar("WildcardExpressionSegment")
                        .match_grammar(&dialect)
                        .unwrap()
                }
                .copy(
                    Some(vec![
                        Ref::new("ExceptClauseSegment").optional().to_matchable(),
                    ]),
                    None,
                    None,
                    None,
                    vec![],
                    false,
                )
            })
            .to_matchable()
            .into(),
        ),
        (
            "ExceptClauseSegment".into(),
            NodeMatcher::new(SyntaxKind::SelectExceptClause, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("EXCEPT").to_matchable(),
                    one_of(vec![
                        Bracketed::new(vec![
                            Delimited::new(vec![
                                Ref::new("SingleIdentifierGrammar").to_matchable(),
                            ])
                            .to_matchable(),
                        ])
                        .to_matchable(),
                        Ref::new("SingleIdentifierGrammar").to_matchable(),
                    ])
                    .to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "SelectClauseModifierSegment".into(),
            NodeMatcher::new(SyntaxKind::SelectClauseModifier, |_dialect| {
                one_of(vec![
                    Sequence::new(vec![
                        Ref::keyword("DISTINCT").to_matchable(),
                        Sequence::new(vec![
                            Ref::keyword("ON").to_matchable(),
                            Bracketed::new(vec![
                                Delimited::new(vec![Ref::new("ExpressionSegment").to_matchable()])
                                    .to_matchable(),
                            ])
                            .to_matchable(),
                        ])
                        .config(|this| {
                            this.optional();
                        })
                        .to_matchable(),
                    ])
                    .to_matchable(),
                    Ref::keyword("ALL").to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "FromExpressionElementSegment".into(),
            NodeMatcher::new(SyntaxKind::FromExpressionElement, |_dialect| {
                Sequence::new(vec![
                    Ref::new("PreTableFunctionKeywordsGrammar")
                        .optional()
                        .to_matchable(),
                    optionally_bracketed(vec![Ref::new("TableExpressionSegment").to_matchable()])
                        .to_matchable(),
                    Ref::new("AliasExpressionSegment")
                        .exclude(one_of(vec![
                            Ref::new("FromClauseTerminatorGrammar").to_matchable(),
                            Ref::new("SamplingExpressionSegment").to_matchable(),
                            Ref::new("JoinLikeClauseGrammar").to_matchable(),
                            Ref::keyword("FINAL").to_matchable(),
                            Ref::new("JoinClauseSegment").to_matchable(),
                        ]))
                        .optional()
                        .to_matchable(),
                    Ref::keyword("FINAL").optional().to_matchable(),
                    Sequence::new(vec![
                        Ref::keyword("WITH").to_matchable(),
                        Ref::keyword("OFFSET").to_matchable(),
                        Ref::new("AliasExpressionSegment").to_matchable(),
                    ])
                    .config(|this| {
                        this.optional();
                    })
                    .to_matchable(),
                    Ref::new("SamplingExpressionSegment")
                        .optional()
                        .to_matchable(),
                    Ref::new("PostTableExpressionGrammar")
                        .optional()
                        .to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "TableEngineFunctionSegment".into(),
            NodeMatcher::new(SyntaxKind::TableEngineFunction, |_dialect| {
                Sequence::new(vec![
                    Sequence::new(vec![
                        Ref::new("FunctionNameSegment")
                            .exclude(one_of(vec![
                                Ref::new("DatePartFunctionNameSegment").to_matchable(),
                                Ref::new("ValuesClauseSegment").to_matchable(),
                            ]))
                            .to_matchable(),
                        Ref::new("FunctionContentsSegment")
                            .optional()
                            .to_matchable(),
                    ])
                    .to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "OnClusterClauseSegment".into(),
            NodeMatcher::new(SyntaxKind::OnClusterClause, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("ON").to_matchable(),
                    Ref::keyword("CLUSTER").to_matchable(),
                    one_of(vec![
                        Ref::new("SingleIdentifierGrammar").to_matchable(),
                        Ref::new("QuotedLiteralSegment").to_matchable(),
                    ])
                    .to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "TableEngineSegment".into(),
            NodeMatcher::new(SyntaxKind::Engine, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("ENGINE").to_matchable(),
                    Ref::new("EqualsSegment").optional().to_matchable(),
                    Sequence::new(vec![
                        Ref::new("TableEngineFunctionSegment").to_matchable(),
                        AnyNumberOf::new(vec![
                            Ref::new("MergeTreesOrderByClauseSegment").to_matchable(),
                            Sequence::new(vec![
                                Ref::keyword("PARTITION").to_matchable(),
                                Ref::keyword("BY").to_matchable(),
                                Ref::new("ExpressionSegment").to_matchable(),
                            ])
                            .to_matchable(),
                            Sequence::new(vec![
                                Ref::keyword("PRIMARY").to_matchable(),
                                Ref::keyword("KEY").to_matchable(),
                                Ref::new("ExpressionSegment").to_matchable(),
                            ])
                            .to_matchable(),
                            Sequence::new(vec![
                                Ref::keyword("SAMPLE").to_matchable(),
                                Ref::keyword("BY").to_matchable(),
                                Ref::new("ExpressionSegment").to_matchable(),
                            ])
                            .to_matchable(),
                        ])
                        .config(|this| {
                            this.max_times_per_element = Some(1);
                        })
                        .to_matchable(),
                        Ref::new("SettingsClauseSegment").optional().to_matchable(),
                    ])
                    .to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "DatabaseEngineFunctionSegment".into(),
            NodeMatcher::new(SyntaxKind::EngineFunction, |_dialect| {
                Sequence::new(vec![
                    Sequence::new(vec![
                        one_of(vec![
                            Ref::keyword("ATOMIC").to_matchable(),
                            Ref::keyword("MYSQL").to_matchable(),
                            Ref::keyword("MATERIALIZEDMYSQL").to_matchable(),
                            Ref::keyword("LAZY").to_matchable(),
                            Ref::keyword("POSTGRESQL").to_matchable(),
                            Ref::keyword("MATERIALIZEDPOSTGRESQL").to_matchable(),
                            Ref::keyword("REPLICATED").to_matchable(),
                            Ref::keyword("SQLITE").to_matchable(),
                        ])
                        .to_matchable(),
                        Ref::new("FunctionContentsSegment")
                            .optional()
                            .to_matchable(),
                    ])
                    .to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "DatabaseEngineSegment".into(),
            NodeMatcher::new(SyntaxKind::DatabaseEngine, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("ENGINE").to_matchable(),
                    Ref::new("EqualsSegment").to_matchable(),
                    Sequence::new(vec![
                        Ref::new("DatabaseEngineFunctionSegment").to_matchable(),
                        AnyNumberOf::new(vec![
                            Ref::new("MergeTreesOrderByClauseSegment").to_matchable(),
                            Sequence::new(vec![
                                Ref::keyword("PARTITION").to_matchable(),
                                Ref::keyword("BY").to_matchable(),
                                Ref::new("ExpressionSegment").to_matchable(),
                            ])
                            .config(|this| {
                                this.optional();
                            })
                            .to_matchable(),
                            Sequence::new(vec![
                                Ref::keyword("PRIMARY").to_matchable(),
                                Ref::keyword("KEY").to_matchable(),
                                Ref::new("ExpressionSegment").to_matchable(),
                            ])
                            .config(|this| {
                                this.optional();
                            })
                            .to_matchable(),
                            Sequence::new(vec![
                                Ref::keyword("SAMPLE").to_matchable(),
                                Ref::keyword("BY").to_matchable(),
                                Ref::new("ExpressionSegment").to_matchable(),
                            ])
                            .config(|this| {
                                this.optional();
                            })
                            .to_matchable(),
                        ])
                        .config(|this| {
                            this.max_times_per_element = Some(1);
                        })
                        .to_matchable(),
                        Ref::new("SettingsClauseSegment").optional().to_matchable(),
                    ])
                    .to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "ColumnTTLSegment".into(),
            NodeMatcher::new(SyntaxKind::ColumnTtlSegment, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("TTL").to_matchable(),
                    Ref::new("ExpressionSegment").to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "TableTTLSegment".into(),
            NodeMatcher::new(SyntaxKind::TableTtlSegment, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("TTL").to_matchable(),
                    Delimited::new(vec![
                        Sequence::new(vec![
                            Ref::new("ExpressionSegment").to_matchable(),
                            one_of(vec![
                                Ref::keyword("DELETE").to_matchable(),
                                Sequence::new(vec![
                                    Ref::keyword("TO").to_matchable(),
                                    Ref::keyword("VOLUME").to_matchable(),
                                    Ref::new("QuotedLiteralSegment").to_matchable(),
                                ])
                                .to_matchable(),
                                Sequence::new(vec![
                                    Ref::keyword("TO").to_matchable(),
                                    Ref::keyword("DISK").to_matchable(),
                                    Ref::new("QuotedLiteralSegment").to_matchable(),
                                ])
                                .to_matchable(),
                            ])
                            .config(|this| {
                                this.optional();
                            })
                            .to_matchable(),
                            Ref::new("WhereClauseSegment").optional().to_matchable(),
                            Ref::new("GroupByClauseSegment").optional().to_matchable(),
                        ])
                        .to_matchable(),
                    ])
                    .to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "ColumnConstraintSegment".into(),
            NodeMatcher::new(SyntaxKind::ColumnConstraintSegment, |_dialect| {
                AnyNumberOf::new(vec![
                    Sequence::new(vec![
                        Sequence::new(vec![
                            Ref::keyword("CONSTRAINT").to_matchable(),
                            Ref::new("ObjectReferenceSegment").to_matchable(),
                        ])
                        .config(|this| {
                            this.optional();
                        })
                        .to_matchable(),
                        one_of(vec![
                            Sequence::new(vec![
                                Ref::keyword("NOT").optional().to_matchable(),
                                Ref::keyword("NULL").to_matchable(),
                            ])
                            .to_matchable(),
                            Sequence::new(vec![
                                Ref::keyword("CHECK").to_matchable(),
                                Bracketed::new(vec![Ref::new("ExpressionSegment").to_matchable()])
                                    .to_matchable(),
                            ])
                            .to_matchable(),
                            Sequence::new(vec![
                                one_of(vec![
                                    Ref::keyword("DEFAULT").to_matchable(),
                                    Ref::keyword("MATERIALIZED").to_matchable(),
                                    Ref::keyword("ALIAS").to_matchable(),
                                ])
                                .to_matchable(),
                                one_of(vec![
                                    Ref::new("LiteralGrammar").to_matchable(),
                                    Ref::new("FunctionSegment").to_matchable(),
                                    Ref::new("BareFunctionSegment").to_matchable(),
                                ])
                                .to_matchable(),
                            ])
                            .to_matchable(),
                            Sequence::new(vec![
                                Ref::keyword("EPHEMERAL").to_matchable(),
                                one_of(vec![
                                    Ref::new("LiteralGrammar").to_matchable(),
                                    Ref::new("FunctionSegment").to_matchable(),
                                    Ref::new("BareFunctionSegment").to_matchable(),
                                ])
                                .config(|this| {
                                    this.optional();
                                })
                                .to_matchable(),
                            ])
                            .to_matchable(),
                            Ref::new("PrimaryKeyGrammar").to_matchable(),
                            Sequence::new(vec![
                                Ref::keyword("CODEC").to_matchable(),
                                Ref::new("FunctionContentsGrammar").to_matchable(),
                            ])
                            .config(|this| {
                                this.optional();
                            })
                            .to_matchable(),
                            Ref::new("ColumnTTLSegment").to_matchable(),
                        ])
                        .to_matchable(),
                    ])
                    .to_matchable(),
                ])
                .config(|this| {
                    this.max_times_per_element = Some(1);
                })
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "CreateDatabaseStatementSegment".into(),
            NodeMatcher::new(SyntaxKind::CreateDatabaseStatement, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("CREATE").to_matchable(),
                    Ref::keyword("DATABASE").to_matchable(),
                    Ref::new("IfNotExistsGrammar").optional().to_matchable(),
                    Ref::new("DatabaseReferenceSegment").to_matchable(),
                    AnyNumberOf::new(vec![
                        Ref::new("OnClusterClauseSegment").optional().to_matchable(),
                        Ref::new("DatabaseEngineSegment").optional().to_matchable(),
                        Sequence::new(vec![
                            Ref::keyword("COMMENT").to_matchable(),
                            Ref::new("SingleIdentifierGrammar").to_matchable(),
                        ])
                        .config(|this| {
                            this.optional();
                        })
                        .to_matchable(),
                    ])
                    .config(|this| {
                        this.max_times_per_element = Some(1);
                    })
                    .to_matchable(),
                    AnyNumberOf::new(vec![
                        Ref::keyword("TABLE").to_matchable(),
                        Ref::keyword("OVERRIDE").to_matchable(),
                        Ref::new("TableReferenceSegment").to_matchable(),
                        Bracketed::new(vec![
                            Delimited::new(vec![
                                Ref::new("TableConstraintSegment").to_matchable(),
                                Ref::new("ColumnDefinitionSegment").to_matchable(),
                                Ref::new("ColumnConstraintSegment").to_matchable(),
                            ])
                            .to_matchable(),
                        ])
                        .config(|this| {
                            this.optional();
                        })
                        .to_matchable(),
                    ])
                    .config(|this| {
                        this.optional();
                    })
                    .to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "RenameStatementSegment".into(),
            NodeMatcher::new(SyntaxKind::RenameTableStatement, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("RENAME").to_matchable(),
                    one_of(vec![
                        Sequence::new(vec![
                            Ref::keyword("TABLE").to_matchable(),
                            Delimited::new(vec![
                                Sequence::new(vec![
                                    Ref::new("TableReferenceSegment").to_matchable(),
                                    Ref::keyword("TO").to_matchable(),
                                    Ref::new("TableReferenceSegment").to_matchable(),
                                ])
                                .to_matchable(),
                            ])
                            .to_matchable(),
                        ])
                        .to_matchable(),
                        Sequence::new(vec![
                            Ref::keyword("DATABASE").to_matchable(),
                            Delimited::new(vec![
                                Sequence::new(vec![
                                    Ref::new("DatabaseReferenceSegment").to_matchable(),
                                    Ref::keyword("TO").to_matchable(),
                                    Ref::new("DatabaseReferenceSegment").to_matchable(),
                                ])
                                .to_matchable(),
                            ])
                            .to_matchable(),
                        ])
                        .to_matchable(),
                        Sequence::new(vec![
                            Ref::keyword("DICTIONARY").to_matchable(),
                            Delimited::new(vec![
                                Sequence::new(vec![
                                    Ref::new("ObjectReferenceSegment").to_matchable(),
                                    Ref::keyword("TO").to_matchable(),
                                    Ref::new("ObjectReferenceSegment").to_matchable(),
                                ])
                                .to_matchable(),
                            ])
                            .to_matchable(),
                        ])
                        .to_matchable(),
                    ])
                    .to_matchable(),
                    Ref::new("OnClusterClauseSegment").optional().to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "CreateTableStatementSegment".into(),
            NodeMatcher::new(SyntaxKind::CreateTableStatement, |_dialect| {
                one_of(vec![
                    Sequence::new(vec![
                        Ref::keyword("CREATE").to_matchable(),
                        Ref::new("OrReplaceGrammar").optional().to_matchable(),
                        Ref::keyword("TABLE").to_matchable(),
                        Ref::new("IfNotExistsGrammar").optional().to_matchable(),
                        Ref::new("TableReferenceSegment").to_matchable(),
                        Ref::new("OnClusterClauseSegment").optional().to_matchable(),
                        one_of(vec![
                            Sequence::new(vec![
                                Bracketed::new(vec![
                                    Delimited::new(vec![
                                        one_of(vec![
                                            Ref::new("TableConstraintSegment").to_matchable(),
                                            Ref::new("ColumnDefinitionSegment").to_matchable(),
                                            Ref::new("ColumnConstraintSegment").to_matchable(),
                                        ])
                                        .to_matchable(),
                                    ])
                                    .to_matchable(),
                                ])
                                .config(|this| {
                                    this.optional();
                                })
                                .to_matchable(),
                                Ref::new("TableEngineSegment").to_matchable(),
                                Sequence::new(vec![
                                    Ref::keyword("AS").to_matchable(),
                                    Ref::new("SelectableGrammar").to_matchable(),
                                ])
                                .config(|this| {
                                    this.optional();
                                })
                                .to_matchable(),
                            ])
                            .to_matchable(),
                            Sequence::new(vec![
                                Ref::keyword("AS").to_matchable(),
                                Ref::new("TableReferenceSegment").to_matchable(),
                                Ref::new("TableEngineSegment").optional().to_matchable(),
                            ])
                            .to_matchable(),
                            Sequence::new(vec![
                                Ref::keyword("AS").to_matchable(),
                                Ref::new("FunctionSegment").to_matchable(),
                            ])
                            .to_matchable(),
                        ])
                        .to_matchable(),
                        AnyNumberOf::new(vec![
                            Sequence::new(vec![
                                Ref::keyword("COMMENT").to_matchable(),
                                one_of(vec![
                                    Ref::new("SingleIdentifierGrammar").to_matchable(),
                                    Ref::new("QuotedIdentifierSegment").to_matchable(),
                                ])
                                .to_matchable(),
                            ])
                            .to_matchable(),
                            Ref::new("TableTTLSegment").to_matchable(),
                        ])
                        .config(|this| {
                            this.max_times_per_element = Some(1);
                            this.optional();
                        })
                        .to_matchable(),
                        Ref::new("TableEndClauseSegment").optional().to_matchable(),
                    ])
                    .to_matchable(),
                    Sequence::new(vec![
                        Ref::keyword("CREATE").to_matchable(),
                        Ref::keyword("TEMPORARY").to_matchable(),
                        Ref::keyword("TABLE").to_matchable(),
                        Ref::new("IfNotExistsGrammar").optional().to_matchable(),
                        Ref::new("TableReferenceSegment").to_matchable(),
                        one_of(vec![
                            Sequence::new(vec![
                                Bracketed::new(vec![
                                    Delimited::new(vec![
                                        one_of(vec![
                                            Ref::new("TableConstraintSegment").to_matchable(),
                                            Ref::new("ColumnDefinitionSegment").to_matchable(),
                                            Ref::new("ColumnConstraintSegment").to_matchable(),
                                        ])
                                        .to_matchable(),
                                    ])
                                    .to_matchable(),
                                ])
                                .config(|this| {
                                    this.optional();
                                })
                                .to_matchable(),
                                Ref::new("TableEngineSegment").to_matchable(),
                                Sequence::new(vec![
                                    Ref::keyword("AS").to_matchable(),
                                    Ref::new("SelectableGrammar").to_matchable(),
                                ])
                                .config(|this| {
                                    this.optional();
                                })
                                .to_matchable(),
                            ])
                            .to_matchable(),
                            Sequence::new(vec![
                                Ref::keyword("AS").to_matchable(),
                                Ref::new("TableReferenceSegment").to_matchable(),
                                Ref::new("TableEngineSegment").optional().to_matchable(),
                            ])
                            .to_matchable(),
                            Sequence::new(vec![
                                Ref::keyword("AS").to_matchable(),
                                Ref::new("FunctionSegment").to_matchable(),
                            ])
                            .to_matchable(),
                            Sequence::new(vec![
                                Ref::keyword("AS").to_matchable(),
                                Ref::new("SelectableGrammar").to_matchable(),
                            ])
                            .config(|this| {
                                this.optional();
                            })
                            .to_matchable(),
                        ])
                        .to_matchable(),
                        AnyNumberOf::new(vec![
                            Sequence::new(vec![
                                Ref::keyword("COMMENT").to_matchable(),
                                one_of(vec![
                                    Ref::new("SingleIdentifierGrammar").to_matchable(),
                                    Ref::new("QuotedIdentifierSegment").to_matchable(),
                                ])
                                .to_matchable(),
                            ])
                            .to_matchable(),
                            Ref::new("TableTTLSegment").to_matchable(),
                        ])
                        .config(|this| {
                            this.max_times_per_element = Some(1);
                            this.optional();
                        })
                        .to_matchable(),
                        Ref::new("TableEndClauseSegment").optional().to_matchable(),
                    ])
                    .to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "CreateViewStatementSegment".into(),
            NodeMatcher::new(SyntaxKind::CreateViewStatement, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("CREATE").to_matchable(),
                    Ref::new("OrReplaceGrammar").optional().to_matchable(),
                    Ref::keyword("VIEW").to_matchable(),
                    Ref::new("IfNotExistsGrammar").optional().to_matchable(),
                    Ref::new("TableReferenceSegment").to_matchable(),
                    Ref::new("OnClusterClauseSegment").optional().to_matchable(),
                    Ref::keyword("AS").to_matchable(),
                    Ref::new("SelectableGrammar").to_matchable(),
                    Ref::new("TableEndClauseSegment").optional().to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "CreateMaterializedViewStatementSegment".into(),
            NodeMatcher::new(SyntaxKind::CreateMaterializedViewStatement, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("CREATE").to_matchable(),
                    Ref::keyword("MATERIALIZED").to_matchable(),
                    Ref::keyword("VIEW").to_matchable(),
                    Ref::new("IfNotExistsGrammar").optional().to_matchable(),
                    Ref::new("TableReferenceSegment").to_matchable(),
                    Ref::new("OnClusterClauseSegment").optional().to_matchable(),
                    one_of(vec![
                        Sequence::new(vec![
                            Ref::keyword("TO").to_matchable(),
                            Ref::new("TableReferenceSegment").to_matchable(),
                            Bracketed::new(vec![
                                Delimited::new(vec![
                                    Ref::new("SingleIdentifierGrammar").to_matchable(),
                                ])
                                .to_matchable(),
                            ])
                            .config(|this| {
                                this.optional();
                            })
                            .to_matchable(),
                            Ref::new("TableEngineSegment").optional().to_matchable(),
                        ])
                        .to_matchable(),
                        Sequence::new(vec![
                            Ref::new("TableEngineSegment").optional().to_matchable(),
                            Sequence::new(vec![
                                Ref::keyword("PARTITION").to_matchable(),
                                Ref::keyword("BY").to_matchable(),
                                Ref::new("ExpressionSegment").to_matchable(),
                            ])
                            .config(|this| {
                                this.optional();
                            })
                            .to_matchable(),
                            Ref::new("MergeTreesOrderByClauseSegment")
                                .optional()
                                .to_matchable(),
                            Ref::new("TableTTLSegment").optional().to_matchable(),
                            Ref::new("SettingsClauseSegment").optional().to_matchable(),
                            Sequence::new(vec![Ref::keyword("POPULATE").to_matchable()])
                                .config(|this| {
                                    this.optional();
                                })
                                .to_matchable(),
                        ])
                        .to_matchable(),
                    ])
                    .to_matchable(),
                    Ref::keyword("AS").to_matchable(),
                    Ref::new("SelectableGrammar").to_matchable(),
                    Ref::new("TableEndClauseSegment").optional().to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "DropTableStatementSegment".into(),
            NodeMatcher::new(SyntaxKind::DropTableStatement, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("DROP").to_matchable(),
                    Ref::keyword("TEMPORARY").optional().to_matchable(),
                    Ref::keyword("TABLE").to_matchable(),
                    Ref::new("IfExistsGrammar").optional().to_matchable(),
                    Ref::new("TableReferenceSegment").to_matchable(),
                    Ref::new("OnClusterClauseSegment").optional().to_matchable(),
                    Ref::keyword("SYNC").optional().to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "DropDatabaseStatementSegment".into(),
            NodeMatcher::new(SyntaxKind::DropDatabaseStatement, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("DROP").to_matchable(),
                    Ref::keyword("DATABASE").to_matchable(),
                    Ref::new("IfExistsGrammar").optional().to_matchable(),
                    Ref::new("DatabaseReferenceSegment").to_matchable(),
                    Ref::new("OnClusterClauseSegment").optional().to_matchable(),
                    Ref::keyword("SYNC").optional().to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "DropDictionaryStatementSegment".into(),
            NodeMatcher::new(SyntaxKind::DropDictionaryStatement, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("DROP").to_matchable(),
                    Ref::keyword("DICTIONARY").to_matchable(),
                    Ref::new("IfExistsGrammar").optional().to_matchable(),
                    Ref::new("SingleIdentifierGrammar").to_matchable(),
                    Ref::keyword("SYNC").optional().to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "DropUserStatementSegment".into(),
            NodeMatcher::new(SyntaxKind::DropUserStatement, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("DROP").to_matchable(),
                    Ref::keyword("USER").to_matchable(),
                    Ref::new("IfExistsGrammar").optional().to_matchable(),
                    Ref::new("SingleIdentifierGrammar").to_matchable(),
                    Ref::new("OnClusterClauseSegment").optional().to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "CreateUserStatementSegment".into(),
            NodeMatcher::new(SyntaxKind::CreateUserStatement, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("CREATE").to_matchable(),
                    Ref::keyword("USER").to_matchable(),
                    Ref::new("IfNotExistsGrammar").optional().to_matchable(),
                    Ref::new("SingleIdentifierGrammar").to_matchable(),
                    Ref::new("OnClusterClauseSegment").optional().to_matchable(),
                    Sequence::new(vec![
                        Ref::keyword("IDENTIFIED").to_matchable(),
                        Sequence::new(vec![
                            Ref::keyword("WITH").to_matchable(),
                            Ref::new("SingleIdentifierGrammar").to_matchable(),
                        ])
                        .config(|this| {
                            this.optional();
                        })
                        .to_matchable(),
                        Sequence::new(vec![
                            Ref::keyword("BY").to_matchable(),
                            Ref::new("QuotedLiteralSegment").to_matchable(),
                        ])
                        .to_matchable(),
                    ])
                    .config(|this| {
                        this.optional();
                    })
                    .to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "DropRoleStatementSegment".into(),
            NodeMatcher::new(SyntaxKind::DropUserStatement, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("DROP").to_matchable(),
                    Ref::keyword("ROLE").to_matchable(),
                    Ref::new("IfExistsGrammar").optional().to_matchable(),
                    Ref::new("SingleIdentifierGrammar").to_matchable(),
                    Ref::new("OnClusterClauseSegment").optional().to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "DropQuotaStatementSegment".into(),
            NodeMatcher::new(SyntaxKind::DropQuotaStatement, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("DROP").to_matchable(),
                    Ref::keyword("QUOTA").to_matchable(),
                    Ref::new("IfExistsGrammar").optional().to_matchable(),
                    Ref::new("SingleIdentifierGrammar").to_matchable(),
                    Ref::new("OnClusterClauseSegment").optional().to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "DropSettingProfileStatementSegment".into(),
            NodeMatcher::new(SyntaxKind::DropSettingProfileStatement, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("DROP").to_matchable(),
                    Delimited::new(vec![Ref::new("NakedIdentifierSegment").to_matchable()])
                        .to_matchable(),
                    Ref::keyword("PROFILE").to_matchable(),
                    Ref::new("IfExistsGrammar").optional().to_matchable(),
                    Ref::new("SingleIdentifierGrammar").to_matchable(),
                    Ref::new("OnClusterClauseSegment").optional().to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "DropViewStatementSegment".into(),
            NodeMatcher::new(SyntaxKind::DropViewStatement, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("DROP").to_matchable(),
                    Ref::keyword("VIEW").to_matchable(),
                    Ref::new("IfExistsGrammar").optional().to_matchable(),
                    Ref::new("TableReferenceSegment").to_matchable(),
                    Ref::new("OnClusterClauseSegment").optional().to_matchable(),
                    Ref::keyword("SYNC").optional().to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "DropFunctionStatementSegment".into(),
            NodeMatcher::new(SyntaxKind::DropFunctionStatement, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("DROP").to_matchable(),
                    Ref::keyword("FUNCTION").to_matchable(),
                    Ref::new("IfExistsGrammar").optional().to_matchable(),
                    Ref::new("SingleIdentifierGrammar").to_matchable(),
                    Ref::new("OnClusterClauseSegment").optional().to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "SystemMergesSegment".into(),
            NodeMatcher::new(SyntaxKind::SystemMergesSegment, |_dialect| {
                Sequence::new(vec![
                    one_of(vec![
                        Ref::keyword("START").to_matchable(),
                        Ref::keyword("STOP").to_matchable(),
                    ])
                    .to_matchable(),
                    Ref::keyword("MERGES").to_matchable(),
                    one_of(vec![
                        Sequence::new(vec![
                            Ref::keyword("ON").to_matchable(),
                            Ref::keyword("VOLUME").to_matchable(),
                            Ref::new("ObjectReferenceSegment").to_matchable(),
                        ])
                        .to_matchable(),
                        Ref::new("TableReferenceSegment").to_matchable(),
                    ])
                    .to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "SystemTTLMergesSegment".into(),
            NodeMatcher::new(SyntaxKind::SystemTtlMergesSegment, |_dialect| {
                Sequence::new(vec![
                    one_of(vec![
                        Ref::keyword("START").to_matchable(),
                        Ref::keyword("STOP").to_matchable(),
                    ])
                    .to_matchable(),
                    Ref::keyword("TTL").to_matchable(),
                    Ref::keyword("MERGES").to_matchable(),
                    Ref::new("TableReferenceSegment").optional().to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "SystemMovesSegment".into(),
            NodeMatcher::new(SyntaxKind::SystemMovesSegment, |_dialect| {
                Sequence::new(vec![
                    one_of(vec![
                        Ref::keyword("START").to_matchable(),
                        Ref::keyword("STOP").to_matchable(),
                    ])
                    .to_matchable(),
                    Ref::keyword("MOVES").to_matchable(),
                    Ref::new("TableReferenceSegment").optional().to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "SystemReplicaSegment".into(),
            NodeMatcher::new(SyntaxKind::SystemReplicaSegment, |_dialect| {
                one_of(vec![
                    Sequence::new(vec![
                        Ref::keyword("SYNC").to_matchable(),
                        Ref::keyword("REPLICA").to_matchable(),
                        Ref::new("OnClusterClauseSegment").optional().to_matchable(),
                        Ref::new("TableReferenceSegment").to_matchable(),
                        Sequence::new(vec![Ref::keyword("STRICT").to_matchable()])
                            .config(|this| {
                                this.optional();
                            })
                            .to_matchable(),
                    ])
                    .to_matchable(),
                    Sequence::new(vec![
                        Ref::keyword("DROP").to_matchable(),
                        Ref::keyword("REPLICA").to_matchable(),
                        Ref::new("SingleIdentifierGrammar").to_matchable(),
                        Sequence::new(vec![
                            Ref::keyword("FROM").to_matchable(),
                            one_of(vec![
                                Sequence::new(vec![
                                    Ref::keyword("DATABASE").to_matchable(),
                                    Ref::new("ObjectReferenceSegment").to_matchable(),
                                ])
                                .to_matchable(),
                                Sequence::new(vec![
                                    Ref::keyword("TABLE").to_matchable(),
                                    Ref::new("TableReferenceSegment").to_matchable(),
                                ])
                                .to_matchable(),
                                Sequence::new(vec![
                                    Ref::keyword("ZKPATH").to_matchable(),
                                    Ref::new("PathSegment").to_matchable(),
                                ])
                                .to_matchable(),
                            ])
                            .to_matchable(),
                        ])
                        .config(|this| {
                            this.optional();
                        })
                        .to_matchable(),
                    ])
                    .to_matchable(),
                    Sequence::new(vec![
                        Ref::keyword("RESTART").to_matchable(),
                        Ref::keyword("REPLICA").to_matchable(),
                        Ref::new("TableReferenceSegment").to_matchable(),
                    ])
                    .to_matchable(),
                    Sequence::new(vec![
                        Ref::keyword("RESTORE").to_matchable(),
                        Ref::keyword("REPLICA").to_matchable(),
                        Ref::new("TableReferenceSegment").to_matchable(),
                        Ref::new("OnClusterClauseSegment").optional().to_matchable(),
                    ])
                    .to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "SystemFilesystemSegment".into(),
            NodeMatcher::new(SyntaxKind::SystemFilesystemSegment, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("DROP").to_matchable(),
                    Ref::keyword("FILESYSTEM").to_matchable(),
                    Ref::keyword("CACHE").to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "SystemReplicatedSegment".into(),
            NodeMatcher::new(SyntaxKind::SystemReplicatedSegment, |_dialect| {
                Sequence::new(vec![
                    one_of(vec![
                        Ref::keyword("START").to_matchable(),
                        Ref::keyword("STOP").to_matchable(),
                    ])
                    .to_matchable(),
                    Ref::keyword("REPLICATED").to_matchable(),
                    Ref::keyword("SENDS").to_matchable(),
                    Ref::new("TableReferenceSegment").optional().to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "SystemReplicationSegment".into(),
            NodeMatcher::new(SyntaxKind::SystemReplicationSegment, |_dialect| {
                Sequence::new(vec![
                    one_of(vec![
                        Ref::keyword("START").to_matchable(),
                        Ref::keyword("STOP").to_matchable(),
                    ])
                    .to_matchable(),
                    Ref::keyword("REPLICATION").to_matchable(),
                    Ref::keyword("QUEUES").to_matchable(),
                    Ref::new("TableReferenceSegment").optional().to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "SystemFetchesSegment".into(),
            NodeMatcher::new(SyntaxKind::SystemFetchesSegment, |_dialect| {
                Sequence::new(vec![
                    one_of(vec![
                        Ref::keyword("START").to_matchable(),
                        Ref::keyword("STOP").to_matchable(),
                    ])
                    .to_matchable(),
                    Ref::keyword("FETCHES").to_matchable(),
                    Ref::new("TableReferenceSegment").optional().to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "SystemDistributedSegment".into(),
            NodeMatcher::new(SyntaxKind::SystemDistributedSegment, |_dialect| {
                Sequence::new(vec![
                    one_of(vec![
                        Sequence::new(vec![
                            one_of(vec![
                                Ref::keyword("START").to_matchable(),
                                Ref::keyword("STOP").to_matchable(),
                            ])
                            .to_matchable(),
                            Ref::keyword("DISTRIBUTED").to_matchable(),
                            Ref::keyword("SENDS").to_matchable(),
                            Ref::new("TableReferenceSegment").to_matchable(),
                        ])
                        .to_matchable(),
                        Sequence::new(vec![
                            Ref::keyword("FLUSH").to_matchable(),
                            Ref::keyword("DISTRIBUTED").to_matchable(),
                            Ref::new("TableReferenceSegment").to_matchable(),
                        ])
                        .to_matchable(),
                    ])
                    .to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "SystemModelSegment".into(),
            NodeMatcher::new(SyntaxKind::SystemModelSegment, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("RELOAD").to_matchable(),
                    one_of(vec![
                        Sequence::new(vec![
                            Ref::keyword("MODELS").to_matchable(),
                            Ref::new("OnClusterClauseSegment").optional().to_matchable(),
                        ])
                        .to_matchable(),
                        Sequence::new(vec![
                            Ref::keyword("MODEL").to_matchable(),
                            AnyNumberOf::new(vec![
                                Ref::new("OnClusterClauseSegment").optional().to_matchable(),
                                Ref::new("PathSegment").to_matchable(),
                            ])
                            .config(|this| {
                                this.max_times_per_element = Some(1);
                            })
                            .to_matchable(),
                        ])
                        .to_matchable(),
                    ])
                    .to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "SystemFileSegment".into(),
            NodeMatcher::new(SyntaxKind::SystemFileSegment, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("SYNC").to_matchable(),
                    Ref::keyword("FILE").to_matchable(),
                    Ref::keyword("CACHE").to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "SystemUnfreezeSegment".into(),
            NodeMatcher::new(SyntaxKind::SystemUnfreezeSegment, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("UNFREEZE").to_matchable(),
                    Ref::keyword("WITH").to_matchable(),
                    Ref::keyword("NAME").to_matchable(),
                    Ref::new("ObjectReferenceSegment").to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "SystemStatementSegment".into(),
            NodeMatcher::new(SyntaxKind::SystemStatement, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("SYSTEM").to_matchable(),
                    one_of(vec![
                        Ref::new("SystemMergesSegment").to_matchable(),
                        Ref::new("SystemTTLMergesSegment").to_matchable(),
                        Ref::new("SystemMovesSegment").to_matchable(),
                        Ref::new("SystemReplicaSegment").to_matchable(),
                        Ref::new("SystemReplicatedSegment").to_matchable(),
                        Ref::new("SystemReplicationSegment").to_matchable(),
                        Ref::new("SystemFetchesSegment").to_matchable(),
                        Ref::new("SystemDistributedSegment").to_matchable(),
                        Ref::new("SystemFileSegment").to_matchable(),
                        Ref::new("SystemFilesystemSegment").to_matchable(),
                        Ref::new("SystemUnfreezeSegment").to_matchable(),
                        Ref::new("SystemModelSegment").to_matchable(),
                    ])
                    .to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "AlterTableStatementSegment".into(),
            NodeMatcher::new(SyntaxKind::AlterTableStatement, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("ALTER").to_matchable(),
                    Ref::keyword("TABLE").to_matchable(),
                    Ref::new("IfExistsGrammar").optional().to_matchable(),
                    Ref::new("TableReferenceSegment").to_matchable(),
                    Ref::new("OnClusterClauseSegment").optional().to_matchable(),
                    one_of(vec![
                        Sequence::new(vec![
                            Ref::keyword("DROP").to_matchable(),
                            Ref::keyword("COLUMN").to_matchable(),
                            Ref::new("IfExistsGrammar").optional().to_matchable(),
                            Ref::new("SingleIdentifierGrammar").to_matchable(),
                        ])
                        .to_matchable(),
                        Sequence::new(vec![
                            Ref::keyword("ADD").to_matchable(),
                            Ref::keyword("COLUMN").to_matchable(),
                            Ref::new("IfNotExistsGrammar").optional().to_matchable(),
                            Ref::new("SingleIdentifierGrammar").to_matchable(),
                            one_of(vec![
                                Sequence::new(vec![
                                    Ref::new("DatatypeSegment").to_matchable(),
                                    Sequence::new(vec![
                                        Ref::keyword("DEFAULT").to_matchable(),
                                        Ref::new("ExpressionSegment").to_matchable(),
                                    ])
                                    .config(|this| {
                                        this.optional();
                                    })
                                    .to_matchable(),
                                    Sequence::new(vec![
                                        Ref::keyword("MATERIALIZED").to_matchable(),
                                        Ref::new("ExpressionSegment").to_matchable(),
                                    ])
                                    .config(|this| {
                                        this.optional();
                                    })
                                    .to_matchable(),
                                    Sequence::new(vec![
                                        Ref::keyword("CODEC").to_matchable(),
                                        Bracketed::new(vec![
                                            Delimited::new(vec![
                                                one_of(vec![
                                                    Ref::new("FunctionSegment").to_matchable(),
                                                    Ref::new("SingleIdentifierGrammar")
                                                        .to_matchable(),
                                                ])
                                                .to_matchable(),
                                            ])
                                            .to_matchable(),
                                        ])
                                        .to_matchable(),
                                    ])
                                    .config(|this| {
                                        this.optional();
                                    })
                                    .to_matchable(),
                                ])
                                .to_matchable(),
                                Sequence::new(vec![
                                    Ref::new("DatatypeSegment").to_matchable(),
                                    Ref::keyword("ALIAS").to_matchable(),
                                    Ref::new("ExpressionSegment").to_matchable(),
                                ])
                                .to_matchable(),
                                Sequence::new(vec![
                                    Ref::keyword("ALIAS").to_matchable(),
                                    Ref::new("ExpressionSegment").to_matchable(),
                                ])
                                .to_matchable(),
                                Sequence::new(vec![
                                    Ref::keyword("DEFAULT").to_matchable(),
                                    Ref::new("ExpressionSegment").to_matchable(),
                                ])
                                .to_matchable(),
                                Sequence::new(vec![
                                    Ref::keyword("MATERIALIZED").to_matchable(),
                                    Ref::new("ExpressionSegment").to_matchable(),
                                ])
                                .to_matchable(),
                            ])
                            .to_matchable(),
                            one_of(vec![
                                Sequence::new(vec![
                                    Ref::keyword("AFTER").to_matchable(),
                                    Ref::new("SingleIdentifierGrammar").to_matchable(),
                                ])
                                .to_matchable(),
                                Ref::keyword("FIRST").to_matchable(),
                            ])
                            .config(|this| {
                                this.optional();
                            })
                            .to_matchable(),
                        ])
                        .to_matchable(),
                        Sequence::new(vec![
                            Ref::keyword("ADD").to_matchable(),
                            Ref::keyword("ALIAS").to_matchable(),
                            Ref::new("IfNotExistsGrammar").optional().to_matchable(),
                            Ref::new("SingleIdentifierGrammar").to_matchable(),
                            Ref::keyword("FOR").to_matchable(),
                            Ref::new("SingleIdentifierGrammar").to_matchable(),
                        ])
                        .to_matchable(),
                        Sequence::new(vec![
                            Ref::keyword("RENAME").to_matchable(),
                            Ref::keyword("COLUMN").to_matchable(),
                            Ref::new("IfExistsGrammar").optional().to_matchable(),
                            Ref::new("SingleIdentifierGrammar").to_matchable(),
                            Ref::keyword("TO").to_matchable(),
                            Ref::new("SingleIdentifierGrammar").to_matchable(),
                        ])
                        .to_matchable(),
                        Sequence::new(vec![
                            Ref::keyword("COMMENT").to_matchable(),
                            Ref::keyword("COLUMN").to_matchable(),
                            Ref::new("IfExistsGrammar").optional().to_matchable(),
                            Ref::new("SingleIdentifierGrammar").to_matchable(),
                            Ref::new("QuotedLiteralSegment").to_matchable(),
                        ])
                        .to_matchable(),
                        Sequence::new(vec![
                            Ref::keyword("COMMENT").to_matchable(),
                            Ref::new("QuotedLiteralSegment").to_matchable(),
                        ])
                        .to_matchable(),
                        Sequence::new(vec![
                            Ref::keyword("MODIFY").to_matchable(),
                            Ref::keyword("COMMENT").to_matchable(),
                            Ref::new("QuotedLiteralSegment").to_matchable(),
                        ])
                        .to_matchable(),
                        Sequence::new(vec![
                            Ref::keyword("MODIFY").to_matchable(),
                            Ref::keyword("COLUMN").to_matchable(),
                            Ref::new("IfExistsGrammar").optional().to_matchable(),
                            Ref::new("SingleIdentifierGrammar").to_matchable(),
                            one_of(vec![
                                Sequence::new(vec![
                                    Ref::keyword("TYPE").to_matchable(),
                                    Ref::new("DatatypeSegment").to_matchable(),
                                    Sequence::new(vec![
                                        Ref::keyword("DEFAULT").to_matchable(),
                                        Ref::new("ExpressionSegment").to_matchable(),
                                    ])
                                    .config(|this| {
                                        this.optional();
                                    })
                                    .to_matchable(),
                                    Sequence::new(vec![
                                        Ref::keyword("MATERIALIZED").to_matchable(),
                                        Ref::new("ExpressionSegment").to_matchable(),
                                    ])
                                    .config(|this| {
                                        this.optional();
                                    })
                                    .to_matchable(),
                                    Sequence::new(vec![
                                        Ref::keyword("ALIAS").to_matchable(),
                                        Ref::new("ExpressionSegment").to_matchable(),
                                    ])
                                    .config(|this| {
                                        this.optional();
                                    })
                                    .to_matchable(),
                                    Sequence::new(vec![
                                        Ref::keyword("CODEC").to_matchable(),
                                        Bracketed::new(vec![
                                            Delimited::new(vec![
                                                one_of(vec![
                                                    Ref::new("FunctionSegment").to_matchable(),
                                                    Ref::new("SingleIdentifierGrammar")
                                                        .to_matchable(),
                                                ])
                                                .to_matchable(),
                                            ])
                                            .config(|this| {
                                                this.delimiter(Ref::new("CommaSegment"));
                                            })
                                            .to_matchable(),
                                        ])
                                        .to_matchable(),
                                    ])
                                    .config(|this| {
                                        this.optional();
                                    })
                                    .to_matchable(),
                                ])
                                .to_matchable(),
                                Sequence::new(vec![
                                    Ref::new("DatatypeSegment").optional().to_matchable(),
                                    Sequence::new(vec![
                                        Ref::keyword("DEFAULT").to_matchable(),
                                        Ref::new("ExpressionSegment").to_matchable(),
                                    ])
                                    .config(|this| {
                                        this.optional();
                                    })
                                    .to_matchable(),
                                    Sequence::new(vec![
                                        Ref::keyword("MATERIALIZED").to_matchable(),
                                        Ref::new("ExpressionSegment").to_matchable(),
                                    ])
                                    .config(|this| {
                                        this.optional();
                                    })
                                    .to_matchable(),
                                    Sequence::new(vec![
                                        Ref::keyword("ALIAS").to_matchable(),
                                        Ref::new("ExpressionSegment").to_matchable(),
                                    ])
                                    .config(|this| {
                                        this.optional();
                                    })
                                    .to_matchable(),
                                    Sequence::new(vec![
                                        Ref::keyword("CODEC").to_matchable(),
                                        Bracketed::new(vec![
                                            Delimited::new(vec![
                                                one_of(vec![
                                                    Ref::new("FunctionSegment").to_matchable(),
                                                    Ref::new("SingleIdentifierGrammar")
                                                        .to_matchable(),
                                                ])
                                                .to_matchable(),
                                            ])
                                            .config(|this| {
                                                this.delimiter(Ref::new("CommaSegment"));
                                            })
                                            .to_matchable(),
                                        ])
                                        .to_matchable(),
                                    ])
                                    .config(|this| {
                                        this.optional();
                                    })
                                    .to_matchable(),
                                ])
                                .to_matchable(),
                                Sequence::new(vec![
                                    Ref::keyword("ALIAS").to_matchable(),
                                    Ref::new("ExpressionSegment").to_matchable(),
                                ])
                                .to_matchable(),
                                Sequence::new(vec![
                                    Ref::keyword("REMOVE").to_matchable(),
                                    Ref::keyword("ALIAS").to_matchable(),
                                ])
                                .to_matchable(),
                                Sequence::new(vec![
                                    Ref::keyword("REMOVE").to_matchable(),
                                    one_of(vec![
                                        Ref::keyword("ALIAS").to_matchable(),
                                        Ref::keyword("DEFAULT").to_matchable(),
                                        Ref::keyword("MATERIALIZED").to_matchable(),
                                        Ref::keyword("CODEC").to_matchable(),
                                        Ref::keyword("COMMENT").to_matchable(),
                                        Ref::keyword("TTL").to_matchable(),
                                    ])
                                    .to_matchable(),
                                ])
                                .to_matchable(),
                                Sequence::new(vec![
                                    Ref::keyword("MODIFY").to_matchable(),
                                    Ref::keyword("SETTING").to_matchable(),
                                    Ref::new("SingleIdentifierGrammar").to_matchable(),
                                    Ref::new("EqualsSegment").to_matchable(),
                                    Ref::new("LiteralGrammar").to_matchable(),
                                ])
                                .to_matchable(),
                                Sequence::new(vec![
                                    Ref::keyword("RESET").to_matchable(),
                                    Ref::keyword("SETTING").to_matchable(),
                                    Ref::new("SingleIdentifierGrammar").to_matchable(),
                                ])
                                .to_matchable(),
                            ])
                            .config(|this| {
                                this.optional();
                            })
                            .to_matchable(),
                            one_of(vec![
                                Sequence::new(vec![
                                    Ref::keyword("AFTER").to_matchable(),
                                    Ref::new("SingleIdentifierGrammar").to_matchable(),
                                ])
                                .to_matchable(),
                                Ref::keyword("FIRST").to_matchable(),
                            ])
                            .config(|this| {
                                this.optional();
                            })
                            .to_matchable(),
                        ])
                        .to_matchable(),
                        Sequence::new(vec![
                            Ref::keyword("ALTER").to_matchable(),
                            Ref::keyword("COLUMN").to_matchable(),
                            Ref::new("IfExistsGrammar").optional().to_matchable(),
                            Ref::new("SingleIdentifierGrammar").to_matchable(),
                            one_of(vec![
                                Sequence::new(vec![
                                    Ref::keyword("TYPE").to_matchable(),
                                    Ref::new("DatatypeSegment").to_matchable(),
                                ])
                                .to_matchable(),
                                Ref::new("DatatypeSegment").to_matchable(),
                            ])
                            .to_matchable(),
                            one_of(vec![
                                Sequence::new(vec![
                                    Ref::keyword("AFTER").to_matchable(),
                                    Ref::new("SingleIdentifierGrammar").to_matchable(),
                                ])
                                .to_matchable(),
                                Ref::keyword("FIRST").to_matchable(),
                            ])
                            .config(|this| {
                                this.optional();
                            })
                            .to_matchable(),
                        ])
                        .to_matchable(),
                        Sequence::new(vec![
                            Ref::keyword("REMOVE").to_matchable(),
                            Ref::keyword("TTL").to_matchable(),
                        ])
                        .to_matchable(),
                        Sequence::new(vec![
                            Ref::keyword("MODIFY").to_matchable(),
                            Ref::keyword("TTL").to_matchable(),
                            Ref::new("ExpressionSegment").to_matchable(),
                        ])
                        .to_matchable(),
                        Sequence::new(vec![
                            Ref::keyword("MODIFY").to_matchable(),
                            Ref::keyword("QUERY").to_matchable(),
                            Ref::new("SelectStatementSegment").to_matchable(),
                        ])
                        .to_matchable(),
                        Sequence::new(vec![
                            Ref::keyword("MATERIALIZE").to_matchable(),
                            Ref::keyword("COLUMN").to_matchable(),
                            Ref::new("SingleIdentifierGrammar").to_matchable(),
                            one_of(vec![
                                Sequence::new(vec![
                                    Ref::keyword("IN").to_matchable(),
                                    Ref::keyword("PARTITION").to_matchable(),
                                    Ref::new("SingleIdentifierGrammar").to_matchable(),
                                ])
                                .to_matchable(),
                                Sequence::new(vec![
                                    Ref::keyword("IN").to_matchable(),
                                    Ref::keyword("PARTITION").to_matchable(),
                                    Ref::keyword("ID").to_matchable(),
                                    Ref::new("QuotedLiteralSegment").to_matchable(),
                                ])
                                .to_matchable(),
                            ])
                            .config(|this| {
                                this.optional();
                            })
                            .to_matchable(),
                        ])
                        .to_matchable(),
                        Sequence::new(vec![
                            Ref::keyword("DROP").to_matchable(),
                            one_of(vec![
                                Ref::keyword("PARTITION").to_matchable(),
                                Ref::keyword("PART").to_matchable(),
                            ])
                            .to_matchable(),
                            Ref::new("SingleIdentifierGrammar").to_matchable(),
                        ])
                        .to_matchable(),
                        Sequence::new(vec![
                            Ref::keyword("REPLACE").to_matchable(),
                            Ref::keyword("PARTITION").to_matchable(),
                            Ref::new("SingleIdentifierGrammar").to_matchable(),
                            Ref::keyword("FROM").to_matchable(),
                            Ref::new("TableReferenceSegment").to_matchable(),
                        ])
                        .to_matchable(),
                    ])
                    .to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "StatementSegment".into(),
            NodeMatcher::new(SyntaxKind::Statement, |_dialect| {
                {
                    let dialect = super::ansi::raw_dialect();
                    dialect
                        .grammar("StatementSegment")
                        .match_grammar(&dialect)
                        .unwrap()
                }
                .copy(
                    Some(vec![
                        Ref::new("CreateUserStatementSegment").to_matchable(),
                        Ref::new("CreateMaterializedViewStatementSegment").to_matchable(),
                        Ref::new("DropDictionaryStatementSegment").to_matchable(),
                        Ref::new("DropQuotaStatementSegment").to_matchable(),
                        Ref::new("DropSettingProfileStatementSegment").to_matchable(),
                        Ref::new("SystemStatementSegment").to_matchable(),
                        Ref::new("RenameStatementSegment").to_matchable(),
                        Ref::new("AlterTableStatementSegment").to_matchable(),
                    ]),
                    None,
                    None,
                    None,
                    vec![],
                    false,
                )
            })
            .to_matchable()
            .into(),
        ),
        (
            "LimitClauseComponentSegment".into(),
            NodeMatcher::new(SyntaxKind::LimitClauseComponent, |_dialect| {
                optionally_bracketed(vec![
                    one_of(vec![
                        Ref::new("NumericLiteralSegment").to_matchable(),
                        Ref::new("ExpressionSegment").to_matchable(),
                    ])
                    .to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "LimitClauseSegment".into(),
            NodeMatcher::new(SyntaxKind::LimitClause, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("LIMIT").to_matchable(),
                    MetaSegment::indent().to_matchable(),
                    Sequence::new(vec![
                        Ref::new("LimitClauseComponentSegment").to_matchable(),
                        one_of(vec![
                            Sequence::new(vec![
                                Ref::keyword("OFFSET").to_matchable(),
                                Ref::new("LimitClauseComponentSegment").to_matchable(),
                            ])
                            .to_matchable(),
                            Sequence::new(vec![
                                Ref::new("CommaSegment").to_matchable(),
                                Ref::new("LimitClauseComponentSegment").to_matchable(),
                            ])
                            .to_matchable(),
                        ])
                        .config(|this| {
                            this.optional();
                        })
                        .to_matchable(),
                        Sequence::new(vec![
                            Ref::keyword("BY").to_matchable(),
                            one_of(vec![
                                Ref::new("BracketedColumnReferenceListGrammar").to_matchable(),
                                Ref::new("ColumnReferenceSegment").to_matchable(),
                            ])
                            .to_matchable(),
                        ])
                        .config(|this| {
                            this.optional();
                        })
                        .to_matchable(),
                    ])
                    .to_matchable(),
                    MetaSegment::dedent().to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "FunctionContentsSegment".into(),
            NodeMatcher::new(SyntaxKind::FunctionContents, |_dialect| {
                one_of(vec![
                    Sequence::new(vec![
                        Bracketed::new(vec![Ref::new("FunctionContentsGrammar").to_matchable()])
                            .to_matchable(),
                        Bracketed::new(vec![Ref::new("FunctionContentsGrammar").to_matchable()])
                            .to_matchable(),
                    ])
                    .to_matchable(),
                    {
                        let dialect = super::ansi::raw_dialect();
                        dialect
                            .grammar("FunctionContentsSegment")
                            .match_grammar(&dialect)
                            .unwrap()
                    },
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "IntervalExpressionSegment".into(),
            NodeMatcher::new(SyntaxKind::IntervalExpression, |_dialect| {
                Sequence::new(vec![
                    Ref::keyword("INTERVAL").to_matchable(),
                    one_of(vec![
                        Sequence::new(vec![
                            Ref::new("NumericLiteralSegment").to_matchable(),
                            Ref::new("DatetimeUnitSegment").to_matchable(),
                        ])
                        .to_matchable(),
                        Ref::new("QuotedLiteralSegment").to_matchable(),
                        Sequence::new(vec![
                            Ref::new("QuotedLiteralSegment").to_matchable(),
                            Ref::new("DatetimeUnitSegment").to_matchable(),
                        ])
                        .to_matchable(),
                        Sequence::new(vec![
                            Ref::new("ExpressionSegment").to_matchable(),
                            Ref::new("DatetimeUnitSegment").to_matchable(),
                        ])
                        .to_matchable(),
                    ])
                    .to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
        (
            "ColumnDefinitionSegment".into(),
            NodeMatcher::new(SyntaxKind::ColumnDefinition, |_dialect| {
                Sequence::new(vec![
                    one_of(vec![
                        Ref::new("SingleIdentifierGrammar").to_matchable(),
                        Ref::new("QuotedIdentifierSegment").to_matchable(),
                    ])
                    .to_matchable(),
                    Ref::new("DatatypeSegment").to_matchable(),
                    AnyNumberOf::new(vec![
                        one_of(vec![
                            Sequence::new(vec![
                                Ref::keyword("DEFAULT").to_matchable(),
                                one_of(vec![
                                    Ref::new("LiteralGrammar").to_matchable(),
                                    Ref::new("FunctionSegment").to_matchable(),
                                    Ref::new("ExpressionSegment").to_matchable(),
                                ])
                                .to_matchable(),
                            ])
                            .to_matchable(),
                            Sequence::new(vec![
                                Ref::keyword("ALIAS").to_matchable(),
                                Ref::new("ExpressionSegment").to_matchable(),
                            ])
                            .to_matchable(),
                            Sequence::new(vec![
                                Ref::keyword("MATERIALIZED").to_matchable(),
                                Ref::new("ExpressionSegment").to_matchable(),
                            ])
                            .to_matchable(),
                            Sequence::new(vec![
                                Ref::keyword("CODEC").to_matchable(),
                                Bracketed::new(vec![
                                    Delimited::new(vec![
                                        one_of(vec![
                                            Ref::new("FunctionSegment").to_matchable(),
                                            Ref::new("SingleIdentifierGrammar").to_matchable(),
                                        ])
                                        .to_matchable(),
                                    ])
                                    .config(|this| {
                                        this.delimiter(Ref::new("CommaSegment"));
                                    })
                                    .to_matchable(),
                                ])
                                .to_matchable(),
                            ])
                            .to_matchable(),
                            Sequence::new(vec![
                                Ref::keyword("COMMENT").to_matchable(),
                                Ref::new("QuotedLiteralSegment").to_matchable(),
                            ])
                            .to_matchable(),
                            Ref::new("ColumnConstraintSegment").to_matchable(),
                        ])
                        .to_matchable(),
                    ])
                    .config(|this| {
                        this.optional();
                    })
                    .to_matchable(),
                ])
                .to_matchable()
            })
            .to_matchable()
            .into(),
        ),
    ]);

    clickhouse_dialect
}
