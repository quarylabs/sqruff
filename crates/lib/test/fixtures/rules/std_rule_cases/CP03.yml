rule: CP03

# Inconsistent capitalisation of functions
test_fail_inconsistent_function_capitalisation_1:
  fail_str: SELECT MAX(id), min(id) from table
  fix_str: SELECT MAX(id), MIN(id) from table

test_fail_inconsistent_function_capitalisation_2:
  fail_str: SELECT MAX(id), min(id) from table
  fix_str: SELECT max(id), min(id) from table
  configs:
    rules:
      capitalisation.functions:
        extended_capitalisation_policy: lower

test_bare_functions:
  fail_str: SELECT current_timestamp from table
  fix_str: SELECT CURRENT_TIMESTAMP from table
  configs:
    rules:
      capitalisation.functions:
        extended_capitalisation_policy: upper

test_bare_functions_2:
  fail_str: SELECT current_timestamp, min(a) from table
  fix_str: SELECT CURRENT_TIMESTAMP, MIN(a) from table
  configs:
    rules:
      capitalisation.functions:
        extended_capitalisation_policy: upper

test_bare_functions_3:
  fail_str: SELECT current_timestamp, min(a) from table
  fix_str: SELECT Current_Timestamp, Min(a) from table
  configs:
    rules:
      capitalisation.functions:
        extended_capitalisation_policy: pascal

test_fail_capitalization_after_comma:
  fail_str: SELECT FLOOR(dt) ,count(*) FROM test
  fix_str: SELECT FLOOR(dt) ,COUNT(*) FROM test

test_pass_fully_qualified_function_mixed_functions:
  pass_str: SELECT COUNT(*), project1.foo(value1) AS value2

test_pass_fully_qualified_function_pascal_case:
  pass_str: SELECT project1.FoO(value1) AS value2

test_pass_ignore_word:
  pass_str: SELECT MAX(id), min(id) FROM TABLE1
  configs:
    rules:
      capitalisation.functions:
        ignore_words: min

test_pass_ignore_templated_code_true:
  ignored: "not set"
  pass_str: |
    SELECT
        {{ "greatest(a, b)" }},
        GREATEST(i, j)
  configs:
    core:
      ignore_templated_areas: true

test_fail_ignore_templated_code_false:
  ignored: "jinja is not supported"
  fail_str: |
    SELECT
        {{ "greatest(a, b)" }},
        GREATEST(i, j)
  fix_str: |
    SELECT
        {{ "greatest(a, b)" }},
        greatest(i, j)
  configs:
    core:
      ignore_templated_areas: false

test_pass_func_name_templated_literal_mix:
  ignored: "looking at templating code"
  # Issue 3022. This was actually a bug in BaseSegment.iter_patches().
  pass_str: SELECT RO(), {{ "t" }}.func()

test_pass_ignore_words_regex_simple:
  pass_str: SELECT MAX(id), f_test_udf(id) FROM TABLE1
  configs:
    rules:
      capitalisation.functions:
        ignore_words_regex: ^f_

test_pass_ignore_words_regex_complex:
  pass_str: SELECT MAX(id), f_test_udf(id), g_test_udf(id) FROM TABLE1
  configs:
    rules:
      capitalisation.functions:
        ignore_words_regex: (^f_|^g_)

test_pass_ignore_words_regex_bigquery_simple:
  pass_str: SELECT MAX(id), project.dataset._f_test_udf(id) FROM TABLE1
  configs:
    core:
      dialect: bigquery
    rules:
      capitalisation.functions:
        ignore_words_regex: ^_f_

test_pass_ignore_words_regex_bigquery_complex:
  pass_str: SELECT MAX(id), project.dataset._f_test_udf(id), `project.dataset._f_test_udf`(id) FROM TABLE1
  configs:
    core:
      dialect: bigquery
    rules:
      capitalisation.functions:
        ignore_words_regex: (^_f_|\._f_)

test_fail_clickhouse_canonical_function_default_policy:
  fail_str: SELECT tointervalminute(1) FROM t
  fix_str: SELECT toIntervalMinute(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_fail_clickhouse_canonical_function_lower_policy:
  fail_str: SELECT tointervalminute(1) FROM t
  fix_str: SELECT toIntervalMinute(1) FROM t
  configs:
    core:
      dialect: clickhouse
    rules:
      capitalisation.functions:
        extended_capitalisation_policy: lower

test_fail_clickhouse_canonical_function_upper_policy:
  fail_str: SELECT tointervalminute(1) FROM t
  fix_str: SELECT toIntervalMinute(1) FROM t
  configs:
    core:
      dialect: clickhouse
    rules:
      capitalisation.functions:
        extended_capitalisation_policy: upper

test_pass_clickhouse_unknown_function_not_rewritten:
  pass_str: SELECT mycustomfunc(1), myCustomFunc(2) FROM t
  configs:
    core:
      dialect: clickhouse

test_fail_clickhouse_mixed_mapped_and_unknown_functions:
  fail_str: SELECT tointervalminute(1), mycustomfunc(2), myCustomFunc(3) FROM t
  fix_str: SELECT toIntervalMinute(1), mycustomfunc(2), myCustomFunc(3) FROM t
  configs:
    core:
      dialect: clickhouse

test_fail_clickhouse_canonical_toyyyymmdd_with_timezone:
  fail_str: SELECT toyyyymmdd(now(), 'US/Eastern') FROM t
  fix_str: SELECT toYYYYMMDD(now(), 'US/Eastern') FROM t
  configs:
    core:
      dialect: clickhouse

test_fail_clickhouse_canonical_toyyyymmdd_with_timezone_lower_policy:
  fail_str: SELECT toyyyymmdd(now(), 'US/Eastern') FROM t
  fix_str: SELECT toYYYYMMDD(now(), 'US/Eastern') FROM t
  configs:
    core:
      dialect: clickhouse
    rules:
      capitalisation.functions:
        extended_capitalisation_policy: lower

test_clickhouse_canonical_function_actionname:
  fail_str: SELECT __actionname(1) FROM t
  fix_str: SELECT __actionName(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_bitboolmaskand:
  fail_str: SELECT __bitboolmaskand(1) FROM t
  fix_str: SELECT __bitBoolMaskAnd(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_bitboolmaskor:
  fail_str: SELECT __bitboolmaskor(1) FROM t
  fix_str: SELECT __bitBoolMaskOr(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_bitswaplasttwo:
  fail_str: SELECT __bitswaplasttwo(1) FROM t
  fix_str: SELECT __bitSwapLastTwo(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_bitwrapperfunc:
  fail_str: SELECT __bitwrapperfunc(1) FROM t
  fix_str: SELECT __bitWrapperFunc(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_getscalar:
  fail_str: SELECT __getscalar(1) FROM t
  fix_str: SELECT __getScalar(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_scalarsubqueryresult:
  fail_str: SELECT __scalarsubqueryresult(1) FROM t
  fix_str: SELECT __scalarSubqueryResult(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_accuratecast:
  fail_str: SELECT accuratecast(1) FROM t
  fix_str: SELECT accurateCast(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_accuratecastordefault:
  fail_str: SELECT accuratecastordefault(1) FROM t
  fix_str: SELECT accurateCastOrDefault(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_accuratecastornull:
  fail_str: SELECT accuratecastornull(1) FROM t
  fix_str: SELECT accurateCastOrNull(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_acosh:
  fail_str: SELECT ACOSH(1) FROM t
  fix_str: SELECT acosh(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_adddays:
  fail_str: SELECT adddays(1) FROM t
  fix_str: SELECT addDays(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_addhours:
  fail_str: SELECT addhours(1) FROM t
  fix_str: SELECT addHours(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_addinterval:
  fail_str: SELECT addinterval(1) FROM t
  fix_str: SELECT addInterval(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_addmicroseconds:
  fail_str: SELECT addmicroseconds(1) FROM t
  fix_str: SELECT addMicroseconds(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_addmilliseconds:
  fail_str: SELECT addmilliseconds(1) FROM t
  fix_str: SELECT addMilliseconds(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_addminutes:
  fail_str: SELECT addminutes(1) FROM t
  fix_str: SELECT addMinutes(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_addmonths:
  fail_str: SELECT addmonths(1) FROM t
  fix_str: SELECT addMonths(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_addnanoseconds:
  fail_str: SELECT addnanoseconds(1) FROM t
  fix_str: SELECT addNanoseconds(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_addquarters:
  fail_str: SELECT addquarters(1) FROM t
  fix_str: SELECT addQuarters(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_addresstoline:
  fail_str: SELECT addresstoline(1) FROM t
  fix_str: SELECT addressToLine(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_addresstolinewithinlines:
  fail_str: SELECT addresstolinewithinlines(1) FROM t
  fix_str: SELECT addressToLineWithInlines(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_addresstosymbol:
  fail_str: SELECT addresstosymbol(1) FROM t
  fix_str: SELECT addressToSymbol(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_addseconds:
  fail_str: SELECT addseconds(1) FROM t
  fix_str: SELECT addSeconds(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_addtupleofintervals:
  fail_str: SELECT addtupleofintervals(1) FROM t
  fix_str: SELECT addTupleOfIntervals(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_addweeks:
  fail_str: SELECT addweeks(1) FROM t
  fix_str: SELECT addWeeks(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_addyears:
  fail_str: SELECT addyears(1) FROM t
  fix_str: SELECT addYears(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_aes_decrypt_mysql:
  fail_str: SELECT AES_DECRYPT_MYSQL(1) FROM t
  fix_str: SELECT aes_decrypt_mysql(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_aes_encrypt_mysql:
  fail_str: SELECT AES_ENCRYPT_MYSQL(1) FROM t
  fix_str: SELECT aes_encrypt_mysql(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_aggthrow:
  fail_str: SELECT aggthrow(1) FROM t
  fix_str: SELECT aggThrow(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_alphatokens:
  fail_str: SELECT alphatokens(1) FROM t
  fix_str: SELECT alphaTokens(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_and:
  fail_str: SELECT AND(1) FROM t
  fix_str: SELECT and(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_any:
  fail_str: SELECT ANY(1) FROM t
  fix_str: SELECT any(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_any_respect_nulls_modifier:
  fail_str: SELECT ANY(1) RESPECT NULLS FROM t
  fix_str: SELECT any(1) RESPECT NULLS FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_any_respect_nulls_modifier_upper_policy:
  fail_str: SELECT ANY(1) RESPECT NULLS FROM t
  fix_str: SELECT any(1) RESPECT NULLS FROM t
  configs:
    core:
      dialect: clickhouse
    rules:
      capitalisation.functions:
        extended_capitalisation_policy: upper

test_clickhouse_case_insensitive_alias_respect_nulls_lower_policy:
  fail_str: SELECT ANY_VALUE(1) RESPECT NULLS FROM t
  fix_str: SELECT any_value(1) RESPECT NULLS FROM t
  configs:
    core:
      dialect: clickhouse
    rules:
      capitalisation.functions:
        extended_capitalisation_policy: lower

test_clickhouse_case_insensitive_alias_respect_nulls_upper_policy:
  fail_str: SELECT any_value(1) RESPECT NULLS FROM t
  fix_str: SELECT ANY_VALUE(1) RESPECT NULLS FROM t
  configs:
    core:
      dialect: clickhouse
    rules:
      capitalisation.functions:
        extended_capitalisation_policy: upper

test_clickhouse_canonical_function_any_respect_nulls:
  fail_str: SELECT ANY_RESPECT_NULLS(1) FROM t
  fix_str: SELECT any_respect_nulls(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_anyheavy:
  fail_str: SELECT anyheavy(1) FROM t
  fix_str: SELECT anyHeavy(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_anylast:
  fail_str: SELECT anylast(1) FROM t
  fix_str: SELECT anyLast(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_anylast_respect_nulls:
  fail_str: SELECT anylast_respect_nulls(1) FROM t
  fix_str: SELECT anyLast_respect_nulls(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_appendtrailingcharifabsent:
  fail_str: SELECT appendtrailingcharifabsent(1) FROM t
  fix_str: SELECT appendTrailingCharIfAbsent(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_argmax:
  fail_str: SELECT argmax(1) FROM t
  fix_str: SELECT argMax(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_argmin:
  fail_str: SELECT argmin(1) FROM t
  fix_str: SELECT argMin(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_array:
  fail_str: SELECT ARRAY(1) FROM t
  fix_str: SELECT array(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arrayaucpr:
  fail_str: SELECT arrayaucpr(1) FROM t
  fix_str: SELECT arrayAUCPR(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arrayall:
  fail_str: SELECT arrayall(1) FROM t
  fix_str: SELECT arrayAll(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arrayavg:
  fail_str: SELECT arrayavg(1) FROM t
  fix_str: SELECT arrayAvg(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arraycompact:
  fail_str: SELECT arraycompact(1) FROM t
  fix_str: SELECT arrayCompact(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arrayconcat:
  fail_str: SELECT arrayconcat(1) FROM t
  fix_str: SELECT arrayConcat(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arraycount:
  fail_str: SELECT arraycount(1) FROM t
  fix_str: SELECT arrayCount(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arraycumsum:
  fail_str: SELECT arraycumsum(1) FROM t
  fix_str: SELECT arrayCumSum(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arraycumsumnonnegative:
  fail_str: SELECT arraycumsumnonnegative(1) FROM t
  fix_str: SELECT arrayCumSumNonNegative(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arraydifference:
  fail_str: SELECT arraydifference(1) FROM t
  fix_str: SELECT arrayDifference(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arraydistinct:
  fail_str: SELECT arraydistinct(1) FROM t
  fix_str: SELECT arrayDistinct(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arraydotproduct:
  fail_str: SELECT arraydotproduct(1) FROM t
  fix_str: SELECT arrayDotProduct(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arrayelement:
  fail_str: SELECT arrayelement(1) FROM t
  fix_str: SELECT arrayElement(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arrayelementornull:
  fail_str: SELECT arrayelementornull(1) FROM t
  fix_str: SELECT arrayElementOrNull(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arrayenumerate:
  fail_str: SELECT arrayenumerate(1) FROM t
  fix_str: SELECT arrayEnumerate(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arrayenumeratedense:
  fail_str: SELECT arrayenumeratedense(1) FROM t
  fix_str: SELECT arrayEnumerateDense(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arrayenumeratedenseranked:
  fail_str: SELECT arrayenumeratedenseranked(1) FROM t
  fix_str: SELECT arrayEnumerateDenseRanked(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arrayenumerateuniq:
  fail_str: SELECT arrayenumerateuniq(1) FROM t
  fix_str: SELECT arrayEnumerateUniq(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arrayenumerateuniqranked:
  fail_str: SELECT arrayenumerateuniqranked(1) FROM t
  fix_str: SELECT arrayEnumerateUniqRanked(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arrayexists:
  fail_str: SELECT arrayexists(1) FROM t
  fix_str: SELECT arrayExists(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arrayfill:
  fail_str: SELECT arrayfill(1) FROM t
  fix_str: SELECT arrayFill(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arrayfilter:
  fail_str: SELECT arrayfilter(1) FROM t
  fix_str: SELECT arrayFilter(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arrayfirst:
  fail_str: SELECT arrayfirst(1) FROM t
  fix_str: SELECT arrayFirst(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arrayfirstindex:
  fail_str: SELECT arrayfirstindex(1) FROM t
  fix_str: SELECT arrayFirstIndex(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arrayfirstornull:
  fail_str: SELECT arrayfirstornull(1) FROM t
  fix_str: SELECT arrayFirstOrNull(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arrayflatten:
  fail_str: SELECT arrayflatten(1) FROM t
  fix_str: SELECT arrayFlatten(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arrayfold:
  fail_str: SELECT arrayfold(1) FROM t
  fix_str: SELECT arrayFold(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arrayintersect:
  fail_str: SELECT arrayintersect(1) FROM t
  fix_str: SELECT arrayIntersect(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arrayjaccardindex:
  fail_str: SELECT arrayjaccardindex(1) FROM t
  fix_str: SELECT arrayJaccardIndex(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arrayjoin:
  fail_str: SELECT arrayjoin(1) FROM t
  fix_str: SELECT arrayJoin(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arraylast:
  fail_str: SELECT arraylast(1) FROM t
  fix_str: SELECT arrayLast(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arraylastindex:
  fail_str: SELECT arraylastindex(1) FROM t
  fix_str: SELECT arrayLastIndex(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arraylastornull:
  fail_str: SELECT arraylastornull(1) FROM t
  fix_str: SELECT arrayLastOrNull(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arraylevenshteindistance:
  fail_str: SELECT arraylevenshteindistance(1) FROM t
  fix_str: SELECT arrayLevenshteinDistance(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arraylevenshteindistanceweighted:
  fail_str: SELECT arraylevenshteindistanceweighted(1) FROM t
  fix_str: SELECT arrayLevenshteinDistanceWeighted(1) FROM t
  configs:
    core:
      dialect: clickhouse

test_clickhouse_canonical_function_arraymap:
  fail_str: SELECT arraymap(1) FROM t
  fix_str: SELECT arrayMap(1) FROM t
  configs:
    core:
      dialect: clickhouse
